# Task Focus - 2025/5/2
**Repository**: https://github.com/jhevener/3DAudioStudio
You have full access to the repo created just for your use.
You can browse to and read any file so first read README.md, DEVELOPMENT_GUIDELINES and README_xAI.md
Then fmilirize your self with the location of the following files 

Tasks: https://github.com/jhevener/3DAudioStudio/tree/main/docs/task-focus
Documentation,snippets and tasks): https://github.com/jhevener/3DAudioStudio/tree/main/docs
Main script: https://github.com/jhevener/3DAudioStudio/tree/main/scripts/autoit/1.3/AudioWizardSeparator_1.3.2.au3
Helper script: https://github.com/jhevener/3DAudioStudio/tree/main/scripts/autoit/1.3/TestModelsIniGUI_1.1.au3
separate.py:  https://github.com/jhevener/3DAudioStudio/tree/main/scripts/autoit/1.3/separate.py
models.ini:  https://github.com/jhevener/3DAudioStudio/tree/main/scripts/autoit/1.3/models.INI 
models dir: https://raw.githubusercontent.com/jhevener/3DAudioStudio/refs/heads/main/docs/ref/models.txt



## Previous Task Focus
- Continuing 2025/15/1

## Initial Conversation
- Today’s session was a productive journey, and I’m excited to summarize our successes as we prepare to start fresh in a new thread. We’ve made significant strides in getting your audio stem separation working seamlessly with your separate.py script, leveraging the Ultimate Vocal Remover (UVR) framework, and enhancing your toolset for music source separation. Here’s a concise overview of our accomplishments:
Summary of Successes
Successful Stem Separation with UVR Models:
We successfully processed song6.wav (4 min 25 s, 11,691,900 samples at 44.1 kHz) and song4.mp3 using the UVR-MDX-NET-Inst_Main.onnx model, producing high-quality vocal and instrumental stems (song6_vocals.wav, song6_instrumental.wav, song4_vocals.mp3, song4_instrumental.mp3) in C:\Git\3DAudioStudio\scripts\autoit\1.3\stems.
You confirmed the sound quality was amazing, marking a major milestone after a challenging day.
Developed a Robust separate.py Script:
We adapted the seanghay/uvr script into your own separate.py, making it a standalone, reliable tool for audio separation.
The script uses defaults (n_fft=6144, dim_f=2048, dim_t=256, hop_length=1024, num_stems=2) and supports MDX-Net ONNX models for 2-stem separation (vocals, instrumental).
Added enhancements:
Recursive directory search for .wav, .flac, and .mp3 files.
Progress summary with error handling for batch processing.
Support for multiple output formats (WAV, FLAC, MP3) using pydub.
Identified Compatible Models:
Confirmed that several UVR MDX-Net models in your collection produce two stems and are directly compatible with separate.py:
UVR-MDX-NET-Inst_1.onnx, UVR-MDX-NET-Inst_2.onnx, UVR-MDX-NET-Inst_3.onnx, UVR-MDX-NET-Inst_HQ_1.onnx, UVR-MDX-NET-Inst_HQ_2.onnx, UVR-MDX-NET-Inst_HQ_3.onnx, UVR-MDX-NET-Inst_HQ_4.onnx, UVR-MDX-NET-Inst_HQ_5.onnx, UVR-MDX-NET-Inst_Main.onnx, UVR-MDX-NET-Inst_full_292.onnx, UVR-MDX-NET_Inst_187_beta.onnx, UVR-MDX-NET_Inst_82_beta.onnx, UVR-MDX-NET_Inst_90_beta.onnx.
Identified other compatible ONNX models like UVR-MDX-NET-Voc_FT.onnx, UVR_MDXNET_KARA_2.onnx, and Kim_*.onnx.
Explored Models for More Stems:
Highlighted models like kuielab_a_vocals.onnx that produce 4 stems (vocals, drums, bass, other) and provided a script modification to support them by updating num_stems=4 and --stems "vocals,drums,bass,other".
Prepared for Broader Model Integration:
Reviewed your extensive model collection (252 models) and categorized them:
ONNX models for direct use.
.pth and .ckpt models requiring conversion to ONNX.
Demucs models for alternative separation via the demucs CLI.
Laid the groundwork for integrating these models into your workflow by suggesting conversion steps and script adjustments.
Reference Material for Your Repository

1. Current AutoIt script focus: TestModelsIniGUI_1.1.au3 (to test models in @ScriptDir & "\models" subfolders)


#include <GUIConstantsEx.au3>
#include <WindowsConstants.au3>
#include <ComboConstants.au3>
#include <EditConstants.au3>
#include <FileConstants.au3>
#include <Array.au3>
#include <MsgBoxConstants.au3>
#include <File.au3>

; GUI Setup
Global $hGUI = GUICreate("Test Models.ini GUI", 600, 500)
Global $idModelCombo = GUICtrlCreateCombo("", 20, 20, 560, 25, $CBS_DROPDOWNLIST)
Global $idModelInfo = GUICtrlCreateEdit("", 20, 50, 560, 100, BitOR($ES_READONLY, $WS_VSCROLL))
Global $idInputFile = GUICtrlCreateInput("", 20, 160, 480, 25)
Global $idInputBrowse = GUICtrlCreateButton("Browse", 510, 160, 70, 25)
Global $idOutputDir = GUICtrlCreateInput(@ScriptDir & "\stems", 20, 190, 480, 25)
Global $idOutputBrowse = GUICtrlCreateButton("Browse", 510, 190, 70, 25)

; First column: SegmentSize, Overlap
Global $idSegmentSizeLabel = GUICtrlCreateLabel("Segment Size (seconds):", 20, 220, 120, 20)
Global $idSegmentSize = GUICtrlCreateCombo("15", 150, 220, 100, 20)
GUICtrlSetData($idSegmentSize, "10|15|20")
Global $idOverlapLabel = GUICtrlCreateLabel("Overlap (samples):", 20, 250, 120, 20)
Global $idOverlap = GUICtrlCreateInput("44100", 150, 250, 100, 20, $ES_NUMBER)

; Second column: Denoise, NFFT, DimF, DimT
Global $idDenoiseLabel = GUICtrlCreateLabel("Denoise:", 300, 220, 120, 20)
Global $idDenoise = GUICtrlCreateCheckbox("Enable Denoise", 430, 220, 100, 20)
GUICtrlSetState($idDenoise, $GUI_CHECKED)
Global $idNFFTLabel = GUICtrlCreateLabel("FFT Size:", 300, 250, 120, 20)
Global $idNFFT = GUICtrlCreateCombo("6144", 430, 250, 100, 20)
GUICtrlSetData($idNFFT, "4096|6144|8192")
Global $idDimFLabel = GUICtrlCreateLabel("Freq Dim:", 300, 280, 120, 20)
Global $idDimF = GUICtrlCreateInput("2048", 430, 280, 100, 20, $ES_NUMBER)
Global $idDimTLabel = GUICtrlCreateLabel("Time Dim:", 300, 310, 120, 20)
Global $idDimT = GUICtrlCreateInput("8", 430, 310, 100, 20, $ES_NUMBER)

Global $idRunButton = GUICtrlCreateButton("Run Separation", 20, 340, 560, 30)
Global $idOutputList = GUICtrlCreateEdit("", 20, 380, 560, 110, BitOR($ES_READONLY, $WS_VSCROLL))
Global $g_sIniPath = @ScriptDir & "\models.ini"
Global $g_sLogPath = @ScriptDir & "\logs\gui_log.txt"
Global $g_aModels[1][15] ; [Name, Focus, Stems, Path, Description, Comments, OutputStems, CommandLine, SegmentSize, Overlap, Denoise, NFFT, DimT, EnvPath, PythonScript]

; Create log directory
DirCreate(@ScriptDir & "\logs")

; Logging function
Func LogMessage($sLevel, $sMessage)
    Local $sTimestamp = @YEAR & "-" & @MON & "-" & @MDAY & " " & @HOUR & ":" & @MIN & ":" & @SEC
    Local $sLogLine = "[" & $sTimestamp & "] " & $sLevel & " GUI: " & $sMessage & @CRLF
    FileWrite($g_sLogPath, $sLogLine)
EndFunc

; Load models.ini
Func LoadModels()
    LogMessage("INFO", "Loading models.ini from " & $g_sIniPath)
    Local $aSections = IniReadSectionNames($g_sIniPath)
    If @error Then
        LogMessage("ERROR", "Failed to read models.ini at " & $g_sIniPath)
        MsgBox($MB_ICONERROR, "Error", "Failed to read models.ini at " & $g_sIniPath)
        Exit
    EndIf
    ReDim $g_aModels[$aSections[0] + 1][15]
    $g_aModels[0][0] = $aSections[0]
    Local $sComboData = ""
    For $i = 1 To $aSections[0]
        $g_aModels[$i][0] = $aSections[$i] ; Name
        $g_aModels[$i][1] = IniRead($g_sIniPath, $aSections[$i], "Focus", "")
        $g_aModels[$i][2] = IniRead($g_sIniPath, $aSections[$i], "Stems", "2")
        $g_aModels[$i][3] = IniRead($g_sIniPath, $aSections[$i], "Path", "")
        $g_aModels[$i][4] = IniRead($g_sIniPath, $aSections[$i], "Description", "")
        $g_aModels[$i][5] = IniRead($g_sIniPath, $aSections[$i], "Comments", "")
        $g_aModels[$i][6] = IniRead($g_sIniPath, $aSections[$i], "OutputStems", "vocals,no_vocals")
        $g_aModels[$i][7] = IniRead($g_sIniPath, $aSections[$i], "CommandLine", "")
        $g_aModels[$i][8] = IniRead($g_sIniPath, $aSections[$i], "SegmentSize", "15")
        $g_aModels[$i][9] = IniRead($g_sIniPath, $aSections[$i], "Overlap", "44100")
        $g_aModels[$i][10] = IniRead($g_sIniPath, $aSections[$i], "Denoise", "True")
        $g_aModels[$i][11] = IniRead($g_sIniPath, $aSections[$i], "NFFT", "6144")
        $g_aModels[$i][12] = IniRead($g_sIniPath, $aSections[$i], "DimT", "8")
        $g_aModels[$i][13] = IniRead($g_sIniPath, $aSections[$i], "EnvPath", "")
        $g_aModels[$i][14] = IniRead($g_sIniPath, $aSections[$i], "PythonScript", "separate.py")
        $sComboData &= $aSections[$i] & "|"
    Next
    GUICtrlSetData($idModelCombo, $sComboData)
    GUICtrlSetData($idModelCombo, $aSections[1]) ; Select first model
    LogMessage("INFO", "Loaded " & $aSections[0] & " models from models.ini")
    UpdateModelInfo()
EndFunc

; Update model info display
Func UpdateModelInfo()
    Local $sModel = GUICtrlRead($idModelCombo)
    LogMessage("INFO", "Selected model: " & $sModel)
    For $i = 1 To $g_aModels[0][0]
        If $g_aModels[$i][0] = $sModel Then
            Local $sInfo = "Name: " & $g_aModels[$i][0] & @CRLF & _
                          "Focus: " & $g_aModels[$i][1] & @CRLF & _
                          "Stems: " & $g_aModels[$i][2] & @CRLF & _
                          "Output Stems: " & $g_aModels[$i][6] & @CRLF & _
                          "Description: " & $g_aModels[$i][4] & @CRLF & _
                          "Comments: " & $g_aModels[$i][5] & @CRLF & _
                          "Default Segment Size: " & $g_aModels[$i][8] & " seconds" & @CRLF & _
                          "Default Overlap: " & $g_aModels[$i][9] & " samples" & @CRLF & _
                          "Default Denoise: " & $g_aModels[$i][10] & @CRLF & _
                          "Default FFT Size: " & $g_aModels[$i][11] & @CRLF & _
                          "Default Freq Dim: " & IniRead($g_sIniPath, $sModel, "DimF", "2048") & @CRLF & _
                          "Default Time Dim: " & $g_aModels[$i][12]
            GUICtrlSetData($idModelInfo, $sInfo)
            GUICtrlSetData($idSegmentSize, $g_aModels[$i][8])
            GUICtrlSetData($idOverlap, $g_aModels[$i][9])
            If $g_aModels[$i][10] = "True" Then
                GUICtrlSetState($idDenoise, $GUI_CHECKED)
            Else
                GUICtrlSetState($idDenoise, $GUI_UNCHECKED)
            EndIf
            GUICtrlSetData($idNFFT, $g_aModels[$i][11])
            GUICtrlSetData($idDimF, IniRead($g_sIniPath, $sModel, "DimF", "2048"))
            GUICtrlSetState($idDimF, $GUI_ENABLE)
            GUICtrlSetData($idDimT, $g_aModels[$i][12])
            GUICtrlSetState($idDimT, $GUI_ENABLE)
            LogMessage("INFO", "Updated model info for " & $sModel)
            ExitLoop
        EndIf
    Next
EndFunc

; Browse for input file
Func BrowseInput()
    Local $sFile = FileOpenDialog("Select Audio File", @ScriptDir & "\songs", "Audio Files (*.mp3;*.wav;*.flac)", 1)
    If Not @error Then
        GUICtrlSetData($idInputFile, $sFile)
        LogMessage("INFO", "Selected input file: " & $sFile)
    EndIf
EndFunc

; Browse for output directory
Func BrowseOutput()
    Local $sDir = FileSelectFolder("Select Output Directory", @ScriptDir & "\stems")
    If Not @error Then
        GUICtrlSetData($idOutputDir, $sDir)
        LogMessage("INFO", "Selected output directory: " & $sDir)
    EndIf
EndFunc

; Run separation
Func RunSeparation()
    Local $sModel = GUICtrlRead($idModelCombo)
    Local $sInput = GUICtrlRead($idInputFile)
    Local $sOutput = GUICtrlRead($idOutputDir)
    Local $sSegmentSize = GUICtrlRead($idSegmentSize)
    Local $sOverlap = GUICtrlRead($idOverlap)
    Local $sDenoise = (GUICtrlRead($idDenoise) = $GUI_CHECKED) ? "True" : "False"
    Local $sNFFT = GUICtrlRead($idNFFT)
    Local $sDimF = GUICtrlRead($idDimF)
    Local $sDimT = GUICtrlRead($idDimT)

    LogMessage("INFO", "Starting separation for model: " & $sModel & ", Input: " & $sInput & ", Output: " & $sOutput & _
               ", SegmentSize: " & $sSegmentSize & ", Overlap: " & $sOverlap & ", Denoise: " & $sDenoise & _
               ", NFFT: " & $sNFFT & ", DimF: " & $sDimF & ", DimT: " & $sDimT)

    ; Validate inputs
    If $sInput = "" Or Not FileExists($sInput) Then
        LogMessage("ERROR", "Invalid input audio file: " & $sInput)
        MsgBox($MB_ICONERROR, "Error", "Please select a valid input audio file.")
        Return
    EndIf
    If $sOutput = "" Or Not FileExists($sOutput) Then
        LogMessage("ERROR", "Invalid output directory: " & $sOutput)
        MsgBox($MB_ICONERROR, "Error", "Please select a valid output directory.")
        Return
    EndIf
    If $sSegmentSize = "" Or Not StringIsInt($sSegmentSize) Or Int($sSegmentSize) <= 0 Then
        LogMessage("ERROR", "Invalid Segment Size: " & $sSegmentSize)
        MsgBox($MB_ICONERROR, "Error", "Segment Size must be a positive integer.")
        Return
    EndIf
    If $sOverlap = "" Or Not StringIsInt($sOverlap) Or Int($sOverlap) <= 0 Then
        LogMessage("ERROR", "Invalid Overlap: " & $sOverlap)
        MsgBox($MB_ICONERROR, "Error", "Overlap must be a positive integer.")
        Return
    EndIf
    If $sNFFT = "" Or Not StringIsInt($sNFFT) Or Int($sNFFT) <= 0 Then
        LogMessage("ERROR", "Invalid FFT Size: " & $sNFFT)
        MsgBox($MB_ICONERROR, "Error", "FFT Size must be a positive integer.")
        Return
    EndIf
    If $sDimF = "" Or Not StringIsInt($sDimF) Or Int($sDimF) <= 0 Then
        LogMessage("ERROR", "Invalid Freq Dim: " & $sDimF)
        MsgBox($MB_ICONERROR, "Error", "Freq Dim must be a positive integer.")
        Return
    EndIf
    If $sDimT = "" Or Not StringIsInt($sDimT) Or Int($sDimT) <= 0 Then
        LogMessage("ERROR", "Invalid Time Dim: " & $sDimT)
        MsgBox($MB_ICONERROR, "Error", "Time Dim must be a positive integer.")
        Return
    EndIf

    ; Get CommandLine
    Local $sCmd = ""
    Local $sEnvPath = ""
    Local $sPythonScript = ""
    For $i = 1 To $g_aModels[0][0]
        If $g_aModels[$i][0] = $sModel Then
            $sCmd = $g_aModels[$i][7]
            $sEnvPath = $g_aModels[$i][13]
            $sPythonScript = $g_aModels[$i][14]
            ExitLoop
        EndIf
    Next
    If $sCmd = "" Then
        LogMessage("ERROR", "CommandLine not found for model: " & $sModel)
        MsgBox($MB_ICONERROR, "Error", "CommandLine not found for model: " & $sModel)
        Return
    EndIf
    If $sEnvPath = "" Then
        LogMessage("ERROR", "EnvPath not found for model: " & $sModel)
        MsgBox($MB_ICONERROR, "Error", "EnvPath not found for model: " & $sModel)
        Return
    EndIf
    If $sPythonScript = "" Then
        LogMessage("ERROR", "PythonScript not found for model: " & $sModel)
        MsgBox($MB_ICONERROR, "Error", "PythonScript not found for model: " & $sModel)
        Return
    EndIf

    ; Get and validate the model path
    Local $sModelPath = IniRead($g_sIniPath, $sModel, "Path", "")
    If $sModelPath = "" Then
        LogMessage("ERROR", "Model path not found for model: " & $sModel)
        MsgBox($MB_ICONERROR, "Error", "Model path not found for model: " & $sModel)
        Return
    EndIf
    Local $sResolvedModelPath = StringReplace($sModelPath, "@ScriptDir@", @ScriptDir)
    If Not FileExists($sResolvedModelPath) Then
        LogMessage("ERROR", "Model file not found: " & $sResolvedModelPath)
        MsgBox($MB_ICONERROR, "Error", "Model file not found: " & $sResolvedModelPath)
        Return
    EndIf

    ; Resolve and validate EnvPath and PythonScript
    Local $sResolvedEnvPath = StringReplace($sEnvPath, "@ScriptDir@", @ScriptDir)
    Local $sResolvedPythonScript = StringReplace($sPythonScript, "@ScriptDir@", @ScriptDir)
    Local $sFullPythonScriptPath = @ScriptDir & "\" & $sResolvedPythonScript
    If Not FileExists($sResolvedEnvPath & "\activate.bat") Then
        LogMessage("ERROR", "Virtual environment not found: " & $sResolvedEnvPath & "\activate.bat")
        MsgBox($MB_ICONERROR, "Error", "Virtual environment not found: " & $sResolvedEnvPath & "\activate.bat")
        Return
    EndIf
    If Not FileExists($sFullPythonScriptPath) Then
        LogMessage("ERROR", "Python script not found: " & $sFullPythonScriptPath)
        MsgBox($MB_ICONERROR, "Error", "Python script not found: " & $sFullPythonScriptPath)
        Return
    EndIf

    ; Substitute placeholders in the CommandLine
    $sCmd = StringReplace($sCmd, "@ScriptDir@", @ScriptDir)
    $sCmd = StringReplace($sCmd, "@SongPath@", $sInput)
    $sCmd = StringReplace($sCmd, "@OutputDir@", $sOutput)
    $sCmd = StringReplace($sCmd, "@SegmentSize@", $sSegmentSize)
    $sCmd = StringReplace($sCmd, "@Overlap@", $sOverlap)
    $sCmd = StringReplace($sCmd, "@Denoise@", $sDenoise)
    $sCmd = StringReplace($sCmd, "@NFFT@", $sNFFT)
    $sCmd = StringReplace($sCmd, "@DimF@", $sDimF)
    $sCmd = StringReplace($sCmd, "@DimT@", $sDimT)
    $sCmd = StringReplace($sCmd, "@Path@", $sResolvedModelPath)
    $sCmd = StringReplace($sCmd, "@EnvPath@", $sResolvedEnvPath)
    $sCmd = StringReplace($sCmd, "@PythonScript@", $sResolvedPythonScript)

    ; Run command with progress monitoring
    LogMessage("INFO", "Resolved command: " & $sCmd)
    GUICtrlSetData($idOutputList, "Running separation for " & $sModel & "..." & @CRLF & "Processing:   0%|          |")
    Local $sOutputText = ""
    Local $sProgress = "Processing:   0%|          |"
    Local $iPID = Run($sCmd, "", @SW_HIDE, $STDERR_MERGED)
    While ProcessExists($iPID)
        Local $sLine = StdoutRead($iPID)
        If @error Then
            ContinueLoop
        EndIf
        If $sLine <> "" Then
            $sOutputText &= $sLine
            If StringInStr($sLine, "Processing:") Then
                Local $aMatch = StringRegExp($sLine, "(Processing:\s+\d+%\|[#\s]+\|)", 1)
                If Not @error Then
                    $sProgress = $aMatch[0]
                EndIf
            EndIf
            GUICtrlSetData($idOutputList, "Running separation for " & $sModel & "..." & @CRLF & $sProgress)
        EndIf
        Sleep(100)
    WEnd
    $sOutputText &= StdoutRead($iPID)
    If @error Then
        LogMessage("ERROR", "Error reading command output for " & $sModel)
        $sOutputText &= "Error reading output." & @CRLF
    EndIf
    LogMessage("INFO", "Command output: " & $sOutputText)

    ; Check generated stems
    Local $aStems = StringSplit(IniRead($g_sIniPath, $sModel, "OutputStems", "vocals,no_vocals"), ",")
    Local $sFilename = StringRegExpReplace($sInput, "^.*\\", "")
    $sFilename = StringRegExpReplace($sFilename, "\.[^.]+$", "")
    Local $sResult = "Separation complete. Generated stems:" & @CRLF
    For $i = 1 To $aStems[0]
        Local $sStemFile = $sOutput & "\" & $sFilename & "_" & $aStems[$i] & ".wav"
        If FileExists($sStemFile) Then
            $sResult &= "- " & $sStemFile & @CRLF
            LogMessage("INFO", "Generated stem: " & $sStemFile)
        Else
            $sResult &= "- [Missing] " & $sStemFile & @CRLF
            LogMessage("ERROR", "Failed to generate stem: " & $sStemFile)
        EndIf
    Next
    $sResult &= @CRLF & "Full Command Line:" & @CRLF & $sCmd & @CRLF
    $sResult &= @CRLF & "Command Output:" & @CRLF & $sOutputText
    GUICtrlSetData($idOutputList, $sResult)
EndFunc

; Main loop
LogMessage("INFO", "Starting Test Models.ini GUI")
LoadModels()
GUISetState(@SW_SHOW)

While 1
    Switch GUIGetMsg()
        Case $GUI_EVENT_CLOSE
            LogMessage("INFO", "Exiting GUI")
            Exit
        Case $idModelCombo
            UpdateModelInfo()
        Case $idInputBrowse
            BrowseInput()
        Case $idOutputBrowse
            BrowseOutput()
        Case $idRunButton
            RunSeparation()
    EndSwitch
WEnd

2. models.ini (partial and modified to support MDXNet parameters)
 (This ini is the core of the apps and is used to construct the sqlite db in AudioWizardSeparator_1.3.2.au3)

[UVR_MDXNET_Inst_Main_Fast]
App=UVR5
Name=UVR-MDX-NET-Inst_Main (Fast)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR-MDX-NET-Inst_Main.onnx
Description=MDX-Net model for isolating main instrumental and vocal tracks (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Inst_Main_Balanced]
App=UVR5
Name=UVR-MDX-NET-Inst_Main (Balanced)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR-MDX-NET-Inst_Main.onnx
Description=MDX-Net model for isolating main instrumental and vocal tracks (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Inst_Main_Quality]
App=UVR5
Name=UVR-MDX-NET-Inst_Main (Quality)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR-MDX-NET-Inst_Main.onnx
Description=MDX-Net model for isolating main instrumental and vocal tracks (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_KARA_2_Fast]
App=UVR5
Name=UVR-MDX-NET-KARA-2 (Fast)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR_MDXNET_KARA_2.onnx
Description=MDX-Net model for karaoke-style vocal/instrumental separation (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_KARA_2_Balanced]
App=UVR5
Name=UVR-MDX-NET-KARA-2 (Balanced)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR_MDXNET_KARA_2.onnx
Description=MDX-Net model for karaoke-style vocal/instrumental separation (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_KARA_2_Quality]
App=UVR5
Name=UVR-MDX-NET-KARA-2 (Quality)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR_MDXNET_KARA_2.onnx
Description=MDX-Net model for karaoke-style vocal/instrumental separation (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Bass_Fast]
App=UVR5
Name=UVR-MDX-NET-Bass (Fast)
Focus=Bass
Stems=4
Path=@ScriptDir@\models\MDXNet\kuielab_a_bass.onnx
Description=MDX-Net model for isolating bass, drums, vocals, and other (optimized for speed).
Comments=dim_f=4096, dim_t=9; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=4096
DimT=9
OutputStems=bass,drums,vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Bass_Balanced]
App=UVR5
Name=UVR-MDX-NET-Bass (Balanced)
Focus=Bass
Stems=4
Path=@ScriptDir@\models\MDXNet\kuielab_a_bass.onnx
Description=MDX-Net model for isolating bass, drums, vocals, and other (balanced speed/quality).
Comments=dim_f=4096, dim_t=9; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=4096
DimT=9
OutputStems=bass,drums,vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Bass_Quality]
App=UVR5
Name=UVR-MDX-NET-Bass (Quality)
Focus=Bass
Stems=4
Path=@ScriptDir@\models\MDXNet\kuielab_a_bass.onnx
Description=MDX-Net model for isolating bass, drums, vocals, and other (optimized for quality).
Comments=dim_f=4096, dim_t=9; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=4096
DimT=9
OutputStems=bass,drums,vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_vocals_Fast]
App=UVR5
Name=kuielab_a_vocals (Fast)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_vocals.onnx
Description=MDX-Net model for isolating vocals and other (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_vocals_Balanced]
App=UVR5
Name=kuielab_a_vocals (Balanced)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_vocals.onnx
Description=MDX-Net model for isolating vocals and other (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_vocals_Quality]
App=UVR5
Name=kuielab_a_vocals (Quality)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_vocals.onnx
Description=MDX-Net model for isolating vocals and other (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_drums_Fast]
App=UVR5
Name=kuielab_a_drums (Fast)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_drums.onnx
Description=MDX-Net model for isolating drums and other (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_drums_Balanced]
App=UVR5
Name=kuielab_a_drums (Balanced)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_drums.onnx
Description=MDX-Net model for isolating drums and other (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_drums_Quality]
App=UVR5
Name=kuielab_a_drums (Quality)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_drums.onnx
Description=MDX-Net model for isolating drums and other (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_vocals_Fast]
App=UVR5
Name=kuielab_b_vocals (Fast)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_vocals.onnx
Description=MDX-Net model for isolating vocals and other, second variant (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_vocals_Balanced]
App=UVR5
Name=kuielab_b_vocals (Balanced)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_vocals.onnx
Description=MDX-Net model for isolating vocals and other, second variant (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_vocals_Quality]
App=UVR5
Name=kuielab_b_vocals (Quality)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_vocals.onnx
Description=MDX-Net model for isolating vocals and other, second variant (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_drums_Fast]
App=UVR5
Name=kuielab_b_drums (Fast)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_drums.onnx
Description=MDX-Net model for isolating drums and other, second variant (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_drums_Balanced]
App=UVR5
Name=kuielab_b_drums (Balanced)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_drums.onnx
Description=MDX-Net model for isolating drums and other, second variant (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_drums_Quality]
App=UVR5
Name=kuielab_b_drums (Quality)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_drums.onnx
Description=MDX-Net model for isolating drums and other, second variant (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Inst_Main_Fast]
App=UVR5
Name=UVR-MDX-NET-Inst_Main (Fast)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR-MDX-NET-Inst_Main.onnx
Description=MDX-Net model for isolating main instrumental and vocal tracks (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Inst_Main_Balanced]
App=UVR5
Name=UVR-MDX-NET-Inst_Main (Balanced)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR-MDX-NET-Inst_Main.onnx
Description=MDX-Net model for isolating main instrumental and vocal tracks (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Inst_Main_Quality]
App=UVR5
Name=UVR-MDX-NET-Inst_Main (Quality)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR-MDX-NET-Inst_Main.onnx
Description=MDX-Net model for isolating main instrumental and vocal tracks (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_KARA_2_Fast]
App=UVR5
Name=UVR-MDX-NET-KARA-2 (Fast)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR_MDXNET_KARA_2.onnx
Description=MDX-Net model for karaoke-style vocal/instrumental separation (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_KARA_2_Balanced]
App=UVR5
Name=UVR-MDX-NET-KARA-2 (Balanced)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR_MDXNET_KARA_2.onnx
Description=MDX-Net model for karaoke-style vocal/instrumental separation (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_KARA_2_Quality]
App=UVR5
Name=UVR-MDX-NET-KARA-2 (Quality)
Focus=Vocals, Instrumental
Stems=2
Path=@ScriptDir@\models\MDXNet\UVR_MDXNET_KARA_2.onnx
Description=MDX-Net model for karaoke-style vocal/instrumental separation (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,no_vocals
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Bass_Fast]
App=UVR5
Name=UVR-MDX-NET-Bass (Fast)
Focus=Bass
Stems=4
Path=@ScriptDir@\models\MDXNet\kuielab_a_bass.onnx
Description=MDX-Net model for isolating bass, drums, vocals, and other (optimized for speed).
Comments=dim_f=4096, dim_t=9; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=4096
DimT=9
OutputStems=bass,drums,vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Bass_Balanced]
App=UVR5
Name=UVR-MDX-NET-Bass (Balanced)
Focus=Bass
Stems=4
Path=@ScriptDir@\models\MDXNet\kuielab_a_bass.onnx
Description=MDX-Net model for isolating bass, drums, vocals, and other (balanced speed/quality).
Comments=dim_f=4096, dim_t=9; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=4096
DimT=9
OutputStems=bass,drums,vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[UVR_MDXNET_Bass_Quality]
App=UVR5
Name=UVR-MDX-NET-Bass (Quality)
Focus=Bass
Stems=4
Path=@ScriptDir@\models\MDXNet\kuielab_a_bass.onnx
Description=MDX-Net model for isolating bass, drums, vocals, and other (optimized for quality).
Comments=dim_f=4096, dim_t=9; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=4096
DimT=9
OutputStems=bass,drums,vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_vocals_Fast]
App=UVR5
Name=kuielab_a_vocals (Fast)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_vocals.onnx
Description=MDX-Net model for isolating vocals and other (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_vocals_Balanced]
App=UVR5
Name=kuielab_a_vocals (Balanced)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_vocals.onnx
Description=MDX-Net model for isolating vocals and other (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_vocals_Quality]
App=UVR5
Name=kuielab_a_vocals (Quality)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_vocals.onnx
Description=MDX-Net model for isolating vocals and other (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_drums_Fast]
App=UVR5
Name=kuielab_a_drums (Fast)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_drums.onnx
Description=MDX-Net model for isolating drums and other (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_drums_Balanced]
App=UVR5
Name=kuielab_a_drums (Balanced)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_drums.onnx
Description=MDX-Net model for isolating drums and other (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_a_drums_Quality]
App=UVR5
Name=kuielab_a_drums (Quality)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_a_drums.onnx
Description=MDX-Net model for isolating drums and other (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_vocals_Fast]
App=UVR5
Name=kuielab_b_vocals (Fast)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_vocals.onnx
Description=MDX-Net model for isolating vocals and other, second variant (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_vocals_Balanced]
App=UVR5
Name=kuielab_b_vocals (Balanced)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_vocals.onnx
Description=MDX-Net model for isolating vocals and other, second variant (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_vocals_Quality]
App=UVR5
Name=kuielab_b_vocals (Quality)
Focus=Vocals
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_vocals.onnx
Description=MDX-Net model for isolating vocals and other, second variant (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=vocals,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_drums_Fast]
App=UVR5
Name=kuielab_b_drums (Fast)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_drums.onnx
Description=MDX-Net model for isolating drums and other, second variant (optimized for speed).
Comments=dim_f=2048, dim_t=8; low overlap for speed.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=512
Overlap=2
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_drums_Balanced]
App=UVR5
Name=kuielab_b_drums (Balanced)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_drums.onnx
Description=MDX-Net model for isolating drums and other, second variant (balanced speed/quality).
Comments=dim_f=2048, dim_t=8; moderate overlap and segment size.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=8
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py

[kuielab_b_drums_Quality]
App=UVR5
Name=kuielab_b_drums (Quality)
Focus=Drums
Stems=2
Path=@ScriptDir@\models\MDXNet\kuielab_b_drums.onnx
Description=MDX-Net model for isolating drums and other, second variant (optimized for quality).
Comments=dim_f=2048, dim_t=8; high overlap for quality, may require more VRAM.
CommandLine=cmd /c "cd @EnvPath@ && activate.bat && cd @ScriptDir@ && python @PythonScript@ "@SongPath@" -m "@Path@" -o "@OutputDir@" --chunks @SegmentSize@ --margin @Overlap@ --denoise @Denoise@ --n_fft @NFFT@ --dim_f @DimF@ --dim_t @DimT@ && deactivate"
SegmentSize=1024
Overlap=16
Denoise=False
NFFT=6144
DimF=2048
DimT=8
OutputStems=drums,other
EnvPath=@ScriptDir@\installs\UVR\uvr_env\Scripts
PythonScript=separate.py


To integrate the UVR success into your AudioWizardSeparator_1.3.2.au3 script, we’ll update the models.ini file to include the compatible UVR MDX-Net models. Your script uses models.ini to define models and their parameters, which are then passed to separate.py.
Updated models.ini (add this to your existing models.ini):
ini

3. separate.py (python script used to utilize uvr virtual python envvironment - we may consider moving later)

import soundfile as sf
import torch
import os
import librosa
import numpy as np
import onnxruntime as ort
from pathlib import Path
from argparse import ArgumentParser
from tqdm import tqdm

class ConvTDFNet:
    def __init__(self, target_name, L, dim_f, dim_t, n_fft, hop=1024):
        super(ConvTDFNet, self).__init__()
        self.dim_c = 4
        self.dim_f = dim_f
        self.dim_t = 2**dim_t
        self.n_fft = n_fft
        self.hop = hop
        self.n_bins = self.n_fft // 2 + 1
        self.chunk_size = hop * (self.dim_t - 1)
        self.window = torch.hann_window(window_length=self.n_fft, periodic=True)
        self.target_name = target_name
        
        out_c = self.dim_c * 4 if target_name == "*" else self.dim_c
        
        self.freq_pad = torch.zeros([1, out_c, self.n_bins - self.dim_f, self.dim_t])
        self.n = L // 2

    def stft(self, x):
        x = x.reshape([-1, self.chunk_size])
        x = torch.stft(
            x,
            n_fft=self.n_fft,
            hop_length=self.hop,
            window=self.window,
            center=True,
            return_complex=True,
        )
        x = torch.view_as_real(x)
        x = x.permute([0, 3, 1, 2])
        x = x.reshape([-1, 2, 2, self.n_bins, self.dim_t]).reshape(
            [-1, self.dim_c, self.n_bins, self.dim_t]
        )
        return x[:, :, : self.dim_f]

    def istft(self, x, freq_pad=None):
        freq_pad = (
            self.freq_pad.repeat([x.shape[0], 1, 1, 1])
            if freq_pad is None
            else freq_pad
        )
        x = torch.cat([x, freq_pad], -2)
        c = 4 * 2 if self.target_name == "*" else 2
        x = x.reshape([-1, c, 2, self.n_bins, self.dim_t]).reshape(
            [-1, 2, self.n_bins, self.dim_t]
        )
        x = x.permute([0, 2, 3, 1])
        x = x.contiguous()
        x = torch.view_as_complex(x)
        x = torch.istft(
            x, n_fft=self.n_fft, hop_length=self.hop, window=self.window, center=True
        )
        return x.reshape([-1, c, self.chunk_size])

class Predictor:
    def __init__(self, args):
        self.args = args
        self.model_ = ConvTDFNet(
            target_name="vocals",
            L=11,
            dim_f=args["dim_f"], 
            dim_t=args["dim_t"], 
            n_fft=args["n_fft"]
        )
        
        if torch.cuda.is_available():
            self.model = ort.InferenceSession(args['model_path'], providers=['CUDAExecutionProvider'])
        else:
            self.model = ort.InferenceSession(args['model_path'], providers=['CPUExecutionProvider'])

    def demix(self, mix):
        samples = mix.shape[-1]
        margin = self.args["margin"]
        chunk_size = self.args["chunks"] * 44100
        
        assert not margin == 0, "margin cannot be zero!"
        
        if margin > chunk_size:
            margin = chunk_size

        segmented_mix = {}
        print(f"Demix: samples={samples}, chunk_size={chunk_size}, margin={margin}")

        if self.args["chunks"] == 0 or samples < chunk_size:
            chunk_size = samples

        counter = -1
        for skip in range(0, samples, chunk_size):
            counter += 1
            s_margin = 0 if counter == 0 else margin
            end = min(skip + chunk_size + margin, samples)
            start = skip - s_margin
            segmented_mix[skip] = mix[:, start:end].copy()
            print(f"Segment {counter}: start={start}, end={end}, shape={segmented_mix[skip].shape}")
            if end == samples:
                break

        if not segmented_mix:
            raise ValueError("No segments created. Check audio length and chunk size.")

        sources = self.demix_base(segmented_mix, margin_size=margin)
        return sources

    def demix_base(self, mixes, margin_size):
        chunked_sources = []
        progress_bar = tqdm(total=len(mixes))
        progress_bar.set_description("Processing")
        
        for mix in mixes:
            cmix = mixes[mix]
            sources = []
            n_sample = cmix.shape[1]
            model = self.model_
            trim = model.n_fft // 2
            gen_size = model.chunk_size - 2 * trim
            pad = gen_size - n_sample % gen_size
            mix_p = np.concatenate(
                (np.zeros((2, trim)), cmix, np.zeros((2, pad)), np.zeros((2, trim))), 1
            )
            mix_waves = []
            i = 0
            while i < n_sample + pad:
                waves = np.array(mix_p[:, i : i + model.chunk_size])
                mix_waves.append(waves)
                i += gen_size
            
            mix_waves = torch.tensor(np.array(mix_waves), dtype=torch.float32)
            print(f"demix_base: mix_waves shape={mix_waves.shape}")
            
            with torch.no_grad():
                _ort = self.model
                spek = model.stft(mix_waves)
                print(f"Spek shape={spek.shape}")
                try:
                    if self.args["denoise"]:
                        spec_pred = (
                            -_ort.run(None, {"input": -spek.cpu().numpy()})[0] * 0.5
                            + _ort.run(None, {"input": spek.cpu().numpy()})[0] * 0.5
                        )
                    else:
                        spec_pred = _ort.run(None, {"input": spek.cpu().numpy()})[0]
                    print(f"spec_pred shape={spec_pred.shape}")
                    tar_waves = model.istft(torch.tensor(spec_pred))
                    print(f"tar_waves shape={tar_waves.shape}")
                except Exception as e:
                    print(f"Error during model inference: {e}")
                    progress_bar.update(1)
                    continue

                tar_signal = (
                    tar_waves[:, :, trim:-trim]
                    .transpose(0, 1)
                    .reshape(2, -1)
                    .numpy()[:, :-pad]
                )
                print(f"tar_signal shape={tar_signal.shape}")

                start = 0 if mix == 0 else margin_size
                end = None if mix == list(mixes.keys())[::-1][0] else -margin_size
                
                if margin_size == 0:
                    end = None
                
                sliced_signal = tar_signal[:, start:end]
                print(f"sliced_signal shape={sliced_signal.shape}")
                if sliced_signal.size > 0:
                    sources.append(sliced_signal)
                else:
                    print(f"Warning: Empty sliced_signal for mix {mix}")

                progress_bar.update(1)

            if sources:
                chunked_sources.append(sources)
            else:
                print(f"Warning: No sources for mix {mix}")

        progress_bar.close()
        if not chunked_sources:
            raise ValueError("No valid sources to concatenate. Check model output or audio input.")
        _sources = np.concatenate(chunked_sources, axis=-1)
        print(f"_sources shape={_sources.shape}")
        return _sources

    def predict(self, file_path):
        mix, rate = librosa.load(file_path, mono=False, sr=44100)
        print(f"Predict: mix shape={mix.shape}, rate={rate}")
        
        if mix.ndim == 1:
            mix = np.asfortranarray([mix, mix])
        
        mix = mix.T
        sources = self.demix(mix.T)
        opt = sources[0].T
        return (mix - opt, opt, rate)

def main():
    parser = ArgumentParser()
    
    parser.add_argument("files", nargs="+", type=Path, default=[], help="Source audio path")
    parser.add_argument("-o", "--output", type=Path, default=Path("separated"), help="Output folder")
    parser.add_argument("-m", "--model_path", type=Path, help="MDX Net ONNX Model path")
    parser.add_argument("-d", "--denoise", type=lambda x: x.lower() == 'true', default=True, help="Enable or disable denoising")
    parser.add_argument("-M", "--margin", type=int, default=44100, help="Margin in samples")
    parser.add_argument("-c", "--chunks", type=int, default=15, help="Chunk size in seconds")
    parser.add_argument("-F", "--n_fft", type=int, default=6144)
    parser.add_argument("-t", "--dim_t", type=int, default=8)
    parser.add_argument("-f", "--dim_f", type=int, default=2048)
    
    args = parser.parse_args()
    dict_args = vars(args)
    
    os.makedirs(args.output, exist_ok=True)
    
    for file_path in args.files:
        print(f"Processing file: {file_path}")
        predictor = Predictor(args=dict_args)
        try:
            vocals, no_vocals, sampling_rate = predictor.predict(file_path)
            filename = os.path.splitext(os.path.split(file_path)[-1])[0]
            sf.write(os.path.join(args.output, filename + "_no_vocals.wav"), no_vocals, sampling_rate)
            sf.write(os.path.join(args.output, filename + "_vocals.wav"), vocals, sampling_rate)
        except Exception as e:
            print(f"Error processing {file_path}: {e}")

if __name__ == "__main__":
    main()

4. Update AudioWizardSeparator_1.3.2.au3
Your AutoIt script (AudioWizardSeparator_1.3.2.au3) reads models.ini to populate a model selection dropdown and execute the separation command. Since separate.py now supports additional arguments like --format, --chunks, and --stems, let’s ensure the script can leverage these features.

;**************************************************
;********************Part 1************************
;**************************************************
#Region Part1
;Edited 043025-0821
#Region ;**** Directives and Includes ****
#AutoIt3Wrapper_Res_Description=AudioWizardSeparator
#AutoIt3Wrapper_Res_Fileversion=1.3.2
#AutoIt3Wrapper_Res_ProductName=Stem Separator
#AutoIt3Wrapper_Res_ProductVersion=1.3.2
#AutoIt3Wrapper_Res_CompanyName=FretzCapo
#AutoIt3Wrapper_Res_LegalCopyright=© 2025 FretzCapo
#AutoIt3Wrapper_Icon=icon.ico
#AutoIt3Wrapper_Res_Language=1033
#AutoIt3Wrapper_Res_requestedExecutionLevel=None
#AutoIt3Wrapper_Run_AU3Check=Y
#AutoIt3Wrapper_AU3Check_Parameters=-d -w 1 -w 2 -w 3 -w 4 -w 5 -w 6 -w 7

#include <Array.au3>
#include <Constants.au3>
#include <File.au3>
#include <GDIPlus.au3>
#include <GuiListView.au3>
#include <GuiTab.au3>
#include <SQLite.au3>
#include <StringConstants.au3>
#include <WindowsConstants.au3>
#include <GUIConstantsEx.au3>
#include <ButtonConstants.au3>
#include <EditConstants.au3>
#include <ComboConstants.au3>
#include <ListViewConstants.au3>
#include <TabConstants.au3>
#include <WinAPI.au3>
#include <WinAPIFiles.au3>
#include <WinAPISys.au3>
#include <Date.au3>

Opt("GUIOnEventMode", 1)
#EndRegion ;**** Directives and Includes ****

#Region ;**** Global Variables and Constants ****
Global Const $GOOGLE_GREEN = 0xFF34C759
Global Const $GOOGLE_YELLOW = 0xFFF4B400
Global Const $GOOGLE_BLUE = 0xFF4285F4
Global Const $GOOGLE_RED = 0xFFDB4437
Global Const $GOOGLE_PURPLE = 0xFF673AB7
Global Const $GOOGLE_ORANGE = 0xFFF57C00
Global Const $GOOGLE_BROWN = 0xFF795548
Global Const $GOOGLE_TEAL = 0xFF26A69A

Global $hGUI, $hInputListView, $hOutputListView, $hBatchList, $hModelCombo, $hTab
Global $hInputDirButton, $hOutputDirButton, $hAddButton, $hClearButton, $hDeleteButton, $hSeparateButton, $hSaveSettingsButton
Global $hModelNameLabel, $hStemsLabel, $hStemsDisplay, $hFocusLabel, $hFocusDisplay
Global $hDescLabel, $hDescEdit, $hCommentsLabel, $hCommentsEdit
Global $hProgressLabel, $hCountLabel, $hGraphic
Global $hGraphicGUI, $hDC, $hGraphics, $hBrushGray, $hBrushGreen, $hBrushYellow, $hPen
Global $iGuiWidth, $iGuiHeight
Global $hDb, $sDbFile
Global $sSettingsIni = @ScriptDir & "\settings.ini"
Global $sModelsIni = @ScriptDir & "\Models.ini"
Global $sUserIni = @ScriptDir & "\user.ini"
Global $sLogFile
Global $sInputPath = @ScriptDir & "\songs"
Global $sOutputPath = @ScriptDir & "\stems"
Global $hAggressivenessLabel, $hAggressivenessInput, $hTTACheckbox, $hHighEndProcessLabel, $hHighEndProcessCombo
$iGuiWidth = Int(IniRead($sSettingsIni, "GUI", "Width", 800))
$iGuiHeight = Int(IniRead($sSettingsIni, "GUI", "Height", 600))
$sDbFile = IniRead($sSettingsIni, "Paths", "DbFile", @ScriptDir & "\models.db")
$sLogFile = IniRead($sSettingsIni, "Paths", "LogDir", @ScriptDir & "\logs") & "\StemSeparator_" & @YEAR & @MON & @MDAY & "_" & @HOUR & @MIN & @SEC & ".log.txt"
If Not FileExists(IniRead($sSettingsIni, "Paths", "LogDir", @ScriptDir & "\logs")) Then DirCreate(IniRead($sSettingsIni, "Paths", "LogDir", @ScriptDir & "\logs"))
#EndRegion ;**** Global Variables and Constants ****

#Region ;**** Logging Functions ****
Func _Log($sMessage, $bError = False)
    Local $sTimestamp = "[" & _Now() & "] " & ($bError ? "ERROR" : "INFO") & ": "
    Local $hFile = FileOpen($sLogFile, 1)
    If $hFile = -1 Then
        ConsoleWrite("Error: Unable to open log file: " & $sLogFile & @CRLF)
        Return
    EndIf
    FileWrite($hFile, $sTimestamp & $sMessage & @CRLF)
    FileClose($hFile)
EndFunc

Func _LogStartupInfo()
    _Log("Entering _LogStartupInfo")
    _Log("Script started")
    _Log("Script Directory: " & @ScriptDir)
    _Log("Working Directory: " & @WorkingDir)
    _Log("OS: " & @OSVersion & " (" & @OSArch & ")")
    _Log("User: " & @UserName)
    _Log("FFmpeg Path: " & IniRead($sSettingsIni, "Paths", "FFmpegPath", "C:\temp\s2S\installs\uvr\ffmpeg\bin\ffmpeg.exe"))
    _Log("Models Database File: " & $sDbFile)
    _Log("Settings INI: " & $sSettingsIni)
    _Log("Models INI: " & $sModelsIni)
    _Log("User INI: " & $sUserIni)
    _Log("Exiting _LogStartupInfo")
EndFunc
#EndRegion ;**** Logging Functions ****

#Region ;**** Initialization Functions ****
Func _UpdateModelDroplist()
    _Log("Entering _UpdateModelDroplist")
    Local $iTabIndex = _GUICtrlTab_GetCurSel($hTab)
    Local $sAppFilter
    Switch $iTabIndex
        Case 0
            $sAppFilter = "Demucs"
        Case 1
            $sAppFilter = "Spleeter"
        Case 2
            $sAppFilter = "UVR5"
        Case Else
            _Log("Invalid tab index: " & $iTabIndex, True)
            GUICtrlSetData($hModelCombo, "|No models available")
            Return
    EndSwitch

    Local $aResult, $iRows, $iCols
    Local $sQuery = "SELECT Models.Name FROM Models INNER JOIN ModelApps ON Models.ModelID = ModelApps.ModelID WHERE ModelApps.App = '" & $sAppFilter & "' ORDER BY Models.Name;"
    _Log("Executing query: " & $sQuery)
    Local $iRet = _SQLite_GetTable2d($hDb, $sQuery, $aResult, $iRows, $iCols)
    If $iRet <> $SQLITE_OK Then
        _Log("Failed to query models: " & _SQLite_ErrMsg(), True)
        GUICtrlSetData($hModelCombo, "|No models available")
        Return
    EndIf

    GUICtrlSetData($hModelCombo, "")
    Local $sModelList = ""
    If $iRows > 0 And IsArray($aResult) And UBound($aResult, 1) >= 2 Then
        For $i = 1 To $iRows
            Local $sModelName = $aResult[$i][0]
            If $sModelName <> "" Then
                $sModelList &= $sModelName & "|"
            EndIf
        Next
    EndIf

    If $sModelList <> "" Then
        $sModelList = StringTrimRight($sModelList, 1)
        _Log("Model list string: " & $sModelList)
        GUICtrlSetData($hModelCombo, "|" & $sModelList)
    Else
        _Log("No models found for " & $sAppFilter)
        GUICtrlSetData($hModelCombo, "|No models available")
    EndIf
    _Log("Exiting _UpdateModelDroplist")
EndFunc

Func _GetModelDetails($sModel)
    _Log("Entering _GetModelDetails for model: " & $sModel)
    If $sModel = "" Then
        _Log("Model name is empty", True)
        Return SetError(3, 0, 0)
    EndIf
    Local $aResult, $iRows, $iCols
    Local $sQuery = "SELECT ModelApps.App, ModelFocuses.Focus, Models.Name, ModelFocuses.Stems, Models.Path, Models.CommandLine, Models.Description, Models.Comments " & _
                    "FROM Models LEFT JOIN ModelApps ON Models.ModelID = ModelApps.ModelID " & _
                    "LEFT JOIN ModelFocuses ON Models.ModelID = ModelFocuses.ModelID " & _
                    "WHERE Models.Name = '" & $sModel & "';"
    _Log("Executing query: " & $sQuery)
    Local $iRet = _SQLite_GetTable2d($hDb, $sQuery, $aResult, $iRows, $iCols)
    If $iRet <> $SQLITE_OK Then
        _Log("SQLite query failed for model " & $sModel & ": " & _SQLite_ErrMsg(), True)
        Return SetError(1, 0, 0)
    EndIf
    If $iRows = 0 Or Not IsArray($aResult) Or UBound($aResult, 1) < 2 Then
        _Log("No details found for model " & $sModel, True)
        Return SetError(2, 0, 0)
    EndIf
    Local $aReturn[8]
    For $i = 0 To 7
        $aReturn[$i] = $aResult[1][$i] = Null ? "" : $aResult[1][$i]
    Next
    _Log("Retrieved details for model " & $sModel)
    Return $aReturn
EndFunc

Func SetDefaults()
    _Log("Entering SetDefaults")

    Local $iDefaultTab = 0
    _Log("Setting default tab to Demucs (index " & $iDefaultTab & ")")
    _GUICtrlTab_SetCurSel($hTab, $iDefaultTab)

    _Log("Triggering _TabHandler to initialize Demucs tab controls and set default model")
    _TabHandler()

    $sInputPath = IniRead($sSettingsIni, "Paths", "InputDir", @ScriptDir & "\songs")
    _Log("Setting default input path to " & $sInputPath)
    If FileExists($sInputPath) Then
        _GUICtrlListView_DeleteAllItems($hInputListView)
        Local $aInputFiles = _FileListToArrayRec($sInputPath, "*.wav;*.mp3;*.flac", $FLTAR_FILES, $FLTAR_RECUR, $FLTAR_NOSORT, $FLTAR_FULLPATH)
        If Not @error Then
            _Log("Found " & $aInputFiles[0] & " audio files in " & $sInputPath)
            For $i = 1 To $aInputFiles[0]
                _GUICtrlListView_AddItem($hInputListView, $aInputFiles[$i])
            Next
        Else
            _Log("No audio files found in " & $sInputPath)
        EndIf
    Else
        _Log("Default input path " & $sInputPath & " does not exist", True)
    EndIf

    $sOutputPath = IniRead($sSettingsIni, "Paths", "OutputDir", @ScriptDir & "\stems")
    _Log("Setting default output path to " & $sOutputPath)
    If FileExists($sOutputPath) Then
        _GUICtrlListView_DeleteAllItems($hOutputListView)
        Local $aOutputFiles = _FileListToArrayRec($sOutputPath, "*.wav;*.mp3;*.flac", $FLTAR_FILES, $FLTAR_RECUR, $FLTAR_NOSORT, $FLTAR_FULLPATH)
        If Not @error Then
            _Log("Found " & $aOutputFiles[0] & " audio files in " & $sOutputPath)
            For $i = 1 To $aOutputFiles[0]
                _GUICtrlListView_AddItem($hOutputListView, $aOutputFiles[$i])
            Next
        Else
            _Log("No audio files found in " & $sOutputPath)
        EndIf
    Else
        _Log("Default output path " & $sOutputPath & " does not exist", True)
    EndIf

    Local $sDefaultSong = IniRead($sSettingsIni, "GUI", "LastSong", @ScriptDir & "\songs\song1.wav")
    _Log("Adding default song " & $sDefaultSong & " to Process Queue")
    If FileExists($sDefaultSong) Then
        _GUICtrlListView_DeleteAllItems($hBatchList)
        _GUICtrlListView_AddItem($hBatchList, $sDefaultSong)
        _GUICtrlListView_SetItemChecked($hBatchList, 0, True)
        _Log("Default song " & $sDefaultSong & " added and checked successfully")
    Else
        _Log("Default song " & $sDefaultSong & " does not exist", True)
    EndIf

    _Log("Exiting SetDefaults")
EndFunc

Func _Main()
    _Log("Entering _Main")
    _LogStartupInfo()
    If Not _InitializeModels() Then
        _Log("Failed to initialize models database", True)
        MsgBox($MB_ICONERROR, "Error", "Failed to initialize models database. See log for details.")
        Exit 1
    EndIf
    _CreateGUI()
    SetDefaults()
    _Log("GUI initialized and defaults set")
    While 1
        Sleep(100)
    WEnd
EndFunc

_Main()
#EndRegion ;**** Initialization Functions ****
#EndRegion Part1



;**************************************************
;********************Part 2************************
;**************************************************
#Region Part2
#Region ;**** GUI Creation Functions ****
Func _CreateGUI()
    _Log("Entering _CreateGUI")
    $hGUI = GUICreate("Audio Wizard Separator 1.3.2", $iGuiWidth, $iGuiHeight, -1, -1, BitOR($WS_CAPTION, $WS_SYSMENU, $WS_SIZEBOX))
    GUISetBkColor(0xFFFFFF)

    ; Top 30 pixels: Buttons for user interaction
    Local $iButtonY = 5
    Local $iButtonCtrlWidth = 80
    Local $iButtonCtrlHeight = 20
    Local $iButtonSpacing = 10
    Local $iTotalButtonWidth = ($iButtonCtrlWidth * 7) + ($iButtonSpacing * 6)
    Local $iButtonXStart = ($iGuiWidth - $iTotalButtonWidth) / 2

    $hInputDirButton = GUICtrlCreateButton("Input Dir", $iButtonXStart, $iButtonY, $iButtonCtrlWidth, $iButtonCtrlHeight)
    GUICtrlSetBkColor($hInputDirButton, $GOOGLE_GREEN)
    $hOutputDirButton = GUICtrlCreateButton("Output Dir", $iButtonXStart + $iButtonCtrlWidth + $iButtonSpacing, $iButtonY, $iButtonCtrlWidth, $iButtonCtrlHeight)
    GUICtrlSetBkColor($hOutputDirButton, $GOOGLE_GREEN)
    $hAddButton = GUICtrlCreateButton("Add", $iButtonXStart + ($iButtonCtrlWidth + $iButtonSpacing) * 2, $iButtonY, $iButtonCtrlWidth, $iButtonCtrlHeight)
    GUICtrlSetBkColor($hAddButton, $GOOGLE_GREEN)
    $hClearButton = GUICtrlCreateButton("Clear", $iButtonXStart + ($iButtonCtrlWidth + $iButtonSpacing) * 3, $iButtonY, $iButtonCtrlWidth, $iButtonCtrlHeight)
    GUICtrlSetBkColor($hClearButton, $GOOGLE_GREEN)
    $hDeleteButton = GUICtrlCreateButton("Delete", $iButtonXStart + ($iButtonCtrlWidth + $iButtonSpacing) * 4, $iButtonY, $iButtonCtrlWidth, $iButtonCtrlHeight)
    GUICtrlSetBkColor($hDeleteButton, $GOOGLE_GREEN)
    $hSeparateButton = GUICtrlCreateButton("Separate", $iButtonXStart + ($iButtonCtrlWidth + $iButtonSpacing) * 5, $iButtonY, $iButtonCtrlWidth, $iButtonCtrlHeight)
    GUICtrlSetBkColor($hSeparateButton, $GOOGLE_GREEN)
    $hSaveSettingsButton = GUICtrlCreateButton("Save Settings", $iButtonXStart + ($iButtonCtrlWidth + $iButtonSpacing) * 6, $iButtonY, $iButtonCtrlWidth, $iButtonCtrlHeight)
    GUICtrlSetBkColor($hSaveSettingsButton, $GOOGLE_GREEN)

    ; Layout: Four quadrants below buttons
    Local $iQuadWidth = ($iGuiWidth - 30) / 2
    Local $iQuadHeight = ($iGuiHeight - 110) / 2
    Local $iLeftQuadX = 10
    Local $iRightQuadX = $iLeftQuadX + $iQuadWidth + 10
    Local $iTopQuadY = 35
    Local $iBottomQuadY = $iTopQuadY + $iQuadHeight + 10

    ; Top-left quadrant: Input ListView for selecting audio files
    $hInputListView = GUICtrlCreateListView("Input Files", $iLeftQuadX, $iTopQuadY, $iQuadWidth, $iQuadHeight, BitOR($LVS_REPORT, $LVS_SHOWSELALWAYS, $LVS_EX_CHECKBOXES, $LVS_EX_GRIDLINES, $LVS_EX_FULLROWSELECT))
    _GUICtrlListView_SetColumnWidth($hInputListView, 0, $iQuadWidth - 20)

    ; Top-right quadrant: Tabbed Control (now filling the entire quadrant)
    $hTab = GUICtrlCreateTab($iRightQuadX, $iTopQuadY, $iQuadWidth, $iQuadHeight)

    ; Tab 1: Demucs
    GUICtrlCreateTabItem("Demucs")
    Local $iTabTopY = $iTopQuadY + 30 ; Adjust for tab header height
    $hModelNameLabel = GUICtrlCreateLabel("Model Name:", $iRightQuadX + 5, $iTabTopY, 70, 20)
    $hModelCombo = GUICtrlCreateCombo("", $iRightQuadX + 80, $iTabTopY, 150, 25, BitOR($CBS_DROPDOWN, $CBS_AUTOHSCROLL, $WS_VSCROLL))
    $hStemsLabel = GUICtrlCreateLabel("Stems:", $iRightQuadX + 235, $iTabTopY, 40, 20)
    $hStemsDisplay = GUICtrlCreateLabel("", $iRightQuadX + 275, $iTabTopY, 30, 20)

    Local $iDetailsX = $iRightQuadX + 5
    Local $iDetailsY = $iTabTopY + 30
    Local $iDetailsWidth = $iQuadWidth - 10
    Local $iLabelHeight = 20
    Local $iLabelSpacing = 25

    $hFocusLabel = GUICtrlCreateLabel("Focus:", $iDetailsX, $iDetailsY, 80, $iLabelHeight)
    $hFocusDisplay = GUICtrlCreateLabel("", $iDetailsX + 80, $iDetailsY, $iDetailsWidth - 80, $iLabelHeight)
    $hDescLabel = GUICtrlCreateLabel("Description:", $iDetailsX, $iDetailsY + $iLabelSpacing, 80, $iLabelHeight)
    $hDescEdit = GUICtrlCreateEdit("", $iDetailsX, $iDetailsY + $iLabelSpacing + 20, $iDetailsWidth, 80, BitOR($ES_AUTOVSCROLL, $ES_WANTRETURN, $WS_VSCROLL))
    $hCommentsLabel = GUICtrlCreateLabel("Comments:", $iDetailsX, $iDetailsY + $iLabelSpacing * 2 + 80, 80, $iLabelHeight)
    $hCommentsEdit = GUICtrlCreateEdit("", $iDetailsX, $iDetailsY + $iLabelSpacing * 2 + 100, $iDetailsWidth, 80, BitOR($ES_AUTOVSCROLL, $ES_WANTRETURN, $WS_VSCROLL))

    ; Tab 2: Spleeter
    GUICtrlCreateTabItem("Spleeter")
    ; Controls are recreated in _TabHandler when the tab is switched

    ; Tab 3: UVR5
    GUICtrlCreateTabItem("UVR5")
    ; Controls are recreated in _TabHandler when the tab is switched

    GUICtrlCreateTabItem("")

    ; Bottom-left quadrant: Output ListView for displaying separated stems
    $hOutputListView = GUICtrlCreateListView("Output Files", $iLeftQuadX, $iBottomQuadY, $iQuadWidth, $iQuadHeight, BitOR($LVS_REPORT, $LVS_SHOWSELALWAYS, $LVS_EX_GRIDLINES, $LVS_EX_FULLROWSELECT))
    _GUICtrlListView_SetColumnWidth($hOutputListView, 0, $iQuadWidth - 20)

    ; Bottom-right quadrant: Process Queue for managing files to separate
    $hBatchList = GUICtrlCreateListView("Process Queue", $iRightQuadX, $iBottomQuadY, $iQuadWidth, $iQuadHeight, BitOR($LVS_REPORT, $LVS_SHOWSELALWAYS, $LVS_EX_CHECKBOXES, $LVS_EX_GRIDLINES, $LVS_EX_FULLROWSELECT))
    _GUICtrlListView_SetColumnWidth($hBatchList, 0, $iQuadWidth - 20)

    ; Bottom: Progress bar and labels for task status
    $hProgressLabel = GUICtrlCreateLabel("Task Progress: 0%", $iLeftQuadX, $iGuiHeight - 65, $iGuiWidth / 2, 20)
    $hCountLabel = GUICtrlCreateLabel("Tasks Completed: 0/0", $iLeftQuadX, $iGuiHeight - 45, $iGuiWidth / 2, 20)
    $hGraphic = GUICtrlCreateGraphic($iLeftQuadX, $iGuiHeight - 25, $iGuiWidth - 20, 20)
    GUICtrlSetBkColor($hGraphic, 0xFFFFFF)
    GUICtrlSetGraphic($hGraphic, $GUI_GR_RECT, 0, 0, $iGuiWidth - 20, 20)
    _GDIPlus_Startup()
    $hGraphicGUI = GUICtrlGetHandle($hGraphic)
    $hDC = _WinAPI_GetDC($hGraphicGUI)
    $hGraphics = _GDIPlus_GraphicsCreateFromHDC($hDC)
    $hBrushGray = _GDIPlus_BrushCreateSolid(0xFFC0C0C0)
    $hBrushGreen = _GDIPlus_BrushCreateSolid($GOOGLE_GREEN)
    $hBrushYellow = _GDIPlus_BrushCreateSolid($GOOGLE_YELLOW)
    $hPen = _GDIPlus_PenCreate(0xFF000000, 1)

    ; Set event handlers for user interaction
    GUICtrlSetOnEvent($hInputDirButton, "_InputButtonHandler")
    GUICtrlSetOnEvent($hOutputDirButton, "_OutputButtonHandler")
    GUICtrlSetOnEvent($hAddButton, "_AddButtonHandler")
    GUICtrlSetOnEvent($hClearButton, "_ClearButtonHandler")
    GUICtrlSetOnEvent($hDeleteButton, "_DeleteButtonHandler")
    GUICtrlSetOnEvent($hSeparateButton, "_SeparateButtonHandler")
    GUICtrlSetOnEvent($hSaveSettingsButton, "_SaveSettingsButtonHandler")
    GUICtrlSetOnEvent($hModelCombo, "_ModelComboHandler")
    GUICtrlSetOnEvent($hTab, "_TabHandler")
    GUICtrlSetOnEvent($hDescEdit, "_DescEditHandler")
    GUICtrlSetOnEvent($hCommentsEdit, "_CommentsEditHandler")
    GUISetOnEvent($GUI_EVENT_CLOSE, "_Exit")

    GUISetState(@SW_SHOW)
    _Log("Exiting _CreateGUI")
EndFunc
#EndRegion ;**** GUI Creation Functions ****

#Region ;**** Model Management Functions ****
Func _InitializeModels()
    _Log("Entering _InitializeModels")
    _SQLite_Startup()
    If @error Then
        _Log("Failed to start SQLite: Error " & @error, True)
        MsgBox($MB_ICONERROR, "Error", "Unable to initialize SQLite.")
        Return SetError(1, 0, False)
    EndIf

    If Not FileExists($sDbFile) Then
        _Log("Database file does not exist: " & $sDbFile & ". Creating from Models.ini")
        $hDb = _SQLite_Open($sDbFile)
        If @error Then
            _Log("Failed to create database " & $sDbFile & ": " & _SQLite_ErrMsg(), True)
            _SQLite_Shutdown()
            MsgBox($MB_ICONERROR, "Error", "Unable to create models database.")
            Return SetError(2, 0, False)
        EndIf
        _Log("Created new database: " & $sDbFile)

        Local $sQuery
        $sQuery = "CREATE TABLE Models (ModelID INTEGER PRIMARY KEY, Name TEXT, Path TEXT, Description TEXT, Comments TEXT, CommandLine TEXT);"
        _SQLite_Exec($hDb, $sQuery)
        If @error Then
            _Log("Failed to create Models table: " & _SQLite_ErrMsg(), True)
            _SQLite_Close($hDb)
            _SQLite_Shutdown()
            Return SetError(3, 0, False)
        EndIf
        _Log("Models table created")

        $sQuery = "CREATE TABLE ModelApps (ModelID INTEGER, App TEXT, FOREIGN KEY(ModelID) REFERENCES Models(ModelID));"
        _SQLite_Exec($hDb, $sQuery)
        If @error Then
            _Log("Failed to create ModelApps table: " & _SQLite_ErrMsg(), True)
            _SQLite_Close($hDb)
            _SQLite_Shutdown()
            Return SetError(4, 0, False)
        EndIf
        _Log("ModelApps table created")

        $sQuery = "CREATE TABLE ModelFocuses (ModelID INTEGER, Focus TEXT, Stems INTEGER, FOREIGN KEY(ModelID) REFERENCES Models(ModelID));"
        _SQLite_Exec($hDb, $sQuery)
        If @error Then
            _Log("Failed to create ModelFocuses table: " & _SQLite_ErrMsg(), True)
            _SQLite_Close($hDb)
            _SQLite_Shutdown()
            Return SetError(5, 0, False)
        EndIf
        _Log("ModelFocuses table created")

        Local $aSections = IniReadSectionNames($sModelsIni)
        If @error Or Not IsArray($aSections) Then
            _Log("Failed to read Models.ini or file is missing: " & $sModelsIni, True)
            Local $iModelID = 4
            Local $sName = "htdemucs"
            Local $sApp = "Demucs"
            Local $sFocus = "Vocals, Drums, Bass, Other"
            Local $iStems = 4
            Local $sPath = "N/A"
            Local $sDescription = "Demucs model for separating audio into vocals, drums, bass, and other."
            Local $sComments = "Good for 4-stem separation but may muffle or phase audio in some genres; test with VR models for comparison."
            Local $sCommandLine = 'cmd /c "cd @ScriptDir@\installs\Demucs\demucs_env\Scripts && activate.bat && python.exe -m demucs -o "@OutputDir@" "@SongPath@" && deactivate"'

            $sQuery = "INSERT INTO Models (ModelID, Name, Path, Description, Comments, CommandLine) VALUES (" & $iModelID & ", '" & $sName & "', '" & $sPath & "', '" & $sDescription & "', '" & $sComments & "', '" & $sCommandLine & "');"
            _SQLite_Exec($hDb, $sQuery)
            If @error Then
                _Log("Failed to insert default model into Models: " & _SQLite_ErrMsg(), True)
                _SQLite_Close($hDb)
                _SQLite_Shutdown()
                Return SetError(6, 0, False)
            EndIf
            _Log("Inserted default ModelID " & $iModelID & " into Models")

            $sQuery = "INSERT INTO ModelApps (ModelID, App) VALUES (" & $iModelID & ", '" & $sApp & "');"
            _SQLite_Exec($hDb, $sQuery)
            If @error Then
                _Log("Failed to insert into ModelApps for default model: " & _SQLite_ErrMsg(), True)
                _SQLite_Close($hDb)
                _SQLite_Shutdown()
                Return SetError(7, 0, False)
            EndIf
            _Log("Inserted default ModelID " & $iModelID & " into ModelApps")

            $sQuery = "INSERT INTO ModelFocuses (ModelID, Focus, Stems) VALUES (" & $iModelID & ", '" & $sFocus & "', " & $iStems & ");"
            _SQLite_Exec($hDb, $sQuery)
            If @error Then
                _Log("Failed to insert into ModelFocuses for default model: " & _SQLite_ErrMsg(), True)
                _SQLite_Close($hDb)
                _SQLite_Shutdown()
                Return SetError(8, 0, False)
            EndIf
            _Log("Inserted default ModelID " & $iModelID & " into ModelFocuses")

            ; Add Spleeter model (2stems) as a default
            $iModelID = 2
            $sName = "2stems"
            $sApp = "Spleeter"
            $sFocus = "Vocals, Instrumental"
            $iStems = 2
            $sPath = "N/A"
            $sDescription = "Basic Spleeter model for separating audio into vocals and instrumental."
            $sComments = "Older model, less effective than UVR; good for quick separation but may leave artifacts."
            $sCommandLine = 'cmd /c "cd @ScriptDir@\installs\Spleeter\spleeter_env\Scripts && activate.bat && python.exe -m spleeter separate -o "@OutputDir@" "@SongPath@" && deactivate"'

            $sQuery = "INSERT INTO Models (ModelID, Name, Path, Description, Comments, CommandLine) VALUES (" & $iModelID & ", '" & $sName & "', '" & $sPath & "', '" & $sDescription & "', '" & $sComments & "', '" & $sCommandLine & "');"
            _SQLite_Exec($hDb, $sQuery)
            If @error Then
                _Log("Failed to insert Spleeter model into Models: " & _SQLite_ErrMsg(), True)
                _SQLite_Close($hDb)
                _SQLite_Shutdown()
                Return SetError(9, 0, False)
            EndIf
            _Log("Inserted Spleeter ModelID " & $iModelID & " into Models")

            $sQuery = "INSERT INTO ModelApps (ModelID, App) VALUES (" & $iModelID & ", '" & $sApp & "');"
            _SQLite_Exec($hDb, $sQuery)
            If @error Then
                _Log("Failed to insert into ModelApps for Spleeter model: " & _SQLite_ErrMsg(), True)
                _SQLite_Close($hDb)
                _SQLite_Shutdown()
                Return SetError(10, 0, False)
            EndIf
            _Log("Inserted Spleeter ModelID " & $iModelID & " into ModelApps")

            $sQuery = "INSERT INTO ModelFocuses (ModelID, Focus, Stems) VALUES (" & $iModelID & ", '" & $sFocus & "', " & $iStems & ");"
            _SQLite_Exec($hDb, $sQuery)
            If @error Then
                _Log("Failed to insert into ModelFocuses for Spleeter model: " & _SQLite_ErrMsg(), True)
                _SQLite_Close($hDb)
                _SQLite_Shutdown()
                Return SetError(11, 0, False)
            EndIf
            _Log("Inserted Spleeter ModelID " & $iModelID & " into ModelFocuses")
        Else
            _Log("Found " & $aSections[0] & " sections in Models.ini")
            For $i = 1 To $aSections[0]
                Local $sSection = $aSections[$i]
                If Not StringRegExp($sSection, "^Model_\d+$") Then ContinueLoop

                Local $sModelID = StringReplace($sSection, "Model_", "")
                Local $sModelApp = IniRead($sModelsIni, $sSection, "App", "")
                Local $sModelName = IniRead($sModelsIni, $sSection, "Name", "")
                Local $sModelFocus = IniRead($sModelsIni, $sSection, "Focus", "")
                Local $iModelStems = IniRead($sModelsIni, $sSection, "Stems", 0)
                Local $sModelPath = IniRead($sModelsIni, $sSection, "Path", "")
                Local $sModelDesc = IniRead($sModelsIni, $sSection, "Description", "")
                Local $sModelComments = IniRead($sModelsIni, $sSection, "Comments", "")
                Local $sModelCmd = IniRead($sModelsIni, $sSection, "CommandLine", "")

                If $sModelName = "" And $sModelID = 2 Then
                    $sModelName = "2stems"
                    _Log("Inferred Name '2stems' for Model_2")
                EndIf

                If $sModelApp = "" Or $sModelName = "" Then
                    _Log("Skipping invalid model entry: " & $sSection, True)
                    ContinueLoop
                EndIf

                $sQuery = "INSERT INTO Models (ModelID, Name, Path, Description, Comments, CommandLine) VALUES (" & $sModelID & ",'" & $sModelName & "','" & $sModelPath & "','" & $sModelDesc & "','" & $sModelComments & "','" & $sModelCmd & "')"
                _SQLite_Exec($hDb, $sQuery)
                If @error Then
                    _Log("Failed to insert model " & $sModelName & ": " & _SQLite_ErrMsg(), True)
                    ContinueLoop
                EndIf

                $sQuery = "INSERT INTO ModelApps (ModelID, App) VALUES (" & $sModelID & ",'" & $sModelApp & "')"
                _SQLite_Exec($hDb, $sQuery)
                If @error Then
                    _Log("Failed to insert app for model " & $sModelName & ": " & _SQLite_ErrMsg(), True)
                    ContinueLoop
                EndIf

                $sQuery = "INSERT INTO ModelFocuses (ModelID, Focus, Stems) VALUES (" & $sModelID & ",'" & $sModelFocus & "'," & $iModelStems & ")"
                _SQLite_Exec($hDb, $sQuery)
                If @error Then
                    _Log("Failed to insert focus for model " & $sModelName & ": " & _SQLite_ErrMsg(), True)
                    ContinueLoop
                EndIf

                _Log("Added model " & $sModelName & " (App: " & $sModelApp & ") to database")
            Next
        EndIf
    Else
        $hDb = _SQLite_Open($sDbFile)
        If @error Then
            _Log("Failed to open database " & $sDbFile & ": " & _SQLite_ErrMsg(), True)
            _SQLite_Shutdown()
            MsgBox($MB_ICONERROR, "Error", "Unable to open models database.")
            Return SetError(12, 0, False)
        EndIf
        _Log("Opened existing database: " & $sDbFile)
    EndIf

    Local $aResult, $iRows, $iCols
    $sQuery = "SELECT COUNT(*) FROM Models"
    _Log("Executing query: " & $sQuery)
    Local $iRet = _SQLite_GetTable2d($hDb, $sQuery, $aResult, $iRows, $iCols)
    If $iRet <> $SQLITE_OK Or $iRows = 0 Or Not IsArray($aResult) Or UBound($aResult, 1) < 2 Then
        _Log("No models found in database", True)
        MsgBox($MB_ICONERROR, "Error", "No models found in database.")
        _SQLite_Close($hDb)
        _SQLite_Shutdown()
        Return SetError(13, 0, False)
    EndIf
    _Log("Found " & $aResult[1][0] & " models in database")

    $sQuery = "SELECT Name FROM Models WHERE Name = 'htdemucs'"
    _Log("Executing query: " & $sQuery)
    $iRet = _SQLite_GetTable2d($hDb, $sQuery, $aResult, $iRows, $iCols)
    If $iRet <> $SQLITE_OK Or $iRows = 0 Then
        _Log("Default model 'htdemucs' not found in database", True)
        MsgBox($MB_ICONWARNING, "Warning", "Default model 'htdemucs' not found.")
    Else
        _Log("Confirmed default model 'htdemucs' exists")
    EndIf

    $sQuery = "SELECT Name FROM Models WHERE Name = '2stems'"
    _Log("Executing query: " & $sQuery)
    $iRet = _SQLite_GetTable2d($hDb, $sQuery, $aResult, $iRows, $iCols)
    If $iRet <> $SQLITE_OK Or $iRows = 0 Then
        _Log("Spleeter model '2stems' not found in database", True)
        MsgBox($MB_ICONWARNING, "Warning", "Spleeter model '2stems' not found.")
    Else
        _Log("Confirmed Spleeter model '2stems' exists")
    EndIf

    _Log("Exiting _InitializeModels")
    Return True
EndFunc

Func _UpdateModelDetails($sModel)
    _Log("Entering _UpdateModelDetails for model: " & $sModel)
    If $sModel = "" Then
        GUICtrlSetData($hStemsDisplay, "")
        GUICtrlSetData($hFocusDisplay, "")
        GUICtrlSetData($hDescEdit, "")
        GUICtrlSetData($hCommentsEdit, "")
        _Log("Cleared model details display")
    Else
        Local $aDetails = _GetModelDetails($sModel)
        If Not @error Then
            _Log("Setting Stems: " & $aDetails[3])
            GUICtrlSetData($hStemsDisplay, $aDetails[3])
            _Log("Setting Focus: " & $aDetails[1])
            GUICtrlSetData($hFocusDisplay, $aDetails[1])
            _Log("Setting Description: " & $aDetails[6])
            GUICtrlSetData($hDescEdit, $aDetails[6])
            _Log("Setting Comments: " & $aDetails[7])
            GUICtrlSetData($hCommentsEdit, $aDetails[7])
            _Log("Updated model details display for " & $sModel)
        Else
            _Log("Failed to update details for " & $sModel, True)
            GUICtrlSetData($hStemsDisplay, "Error")
            GUICtrlSetData($hFocusDisplay, "Error")
            GUICtrlSetData($hDescEdit, "Error retrieving model details")
            GUICtrlSetData($hCommentsEdit, "Error retrieving model details")
        EndIf
    EndIf
    _Log("Exiting _UpdateModelDetails")
EndFunc

Func _SaveModelDetails($sModel, $sDescription, $sComments)
    _Log("Entering _SaveModelDetails for model: " & $sModel)
    Local $sQuery = "UPDATE Models SET Description = '" & $sDescription & "', Comments = '" & $sComments & "' WHERE Name = '" & $sModel & "'"
    _Log("Executing query: " & $sQuery)
    Local $iRet = _SQLite_Exec($hDb, $sQuery)
    If $iRet <> $SQLITE_OK Then
        _Log("Failed to save details for model " & $sModel & ": " & _SQLite_ErrMsg(), True)
        Return False
    EndIf
    _Log("Saved description and comments for " & $sModel)
    Return True
EndFunc

Func _IsModelCompatibleWithTab($sModel, $iTabIndex)
    _Log("Entering _IsModelCompatibleWithTab: Model=" & $sModel & ", TabIndex=" & $iTabIndex)
    Local $aDetails = _GetModelDetails($sModel)
    If @error Then
        _Log("Failed to get model details for compatibility check", True)
        Return False
    EndIf
    Local $sApp = $aDetails[0]
    Local $bCompatible = False
    Switch $iTabIndex
        Case 0
            $bCompatible = ($sApp = "Demucs")
        Case 1
            $bCompatible = ($sApp = "Spleeter")
        Case 2
            $bCompatible = ($sApp = "UVR5")
    EndSwitch
    _Log("Model compatibility check: " & $sModel & " (App: " & $sApp & ") is " & ($bCompatible ? "" : "not ") & "compatible with tab " & $iTabIndex)
    Return $bCompatible
EndFunc
#EndRegion ;**** Model Management Functions ****
#EndRegion Part2



;**************************************************
;********************Part 3************************
;**************************************************
#Region Part3
#Region ;**** Separation Functions ****
Func _ProcessDemucs($sSong, $sModel, $sOutputDir)
    _Log("Entering _ProcessDemucs: File=" & $sSong & ", Model=" & $sModel)

    ; Define the full path to Demucs's python.exe
    Local $sPythonPath = @ScriptDir & "\installs\Demucs\demucs_env\Scripts\python.exe"
    If Not FileExists($sPythonPath) Then
        _Log("Python executable not found in Demucs virtual environment: " & $sPythonPath, True)
        MsgBox($MB_ICONERROR, "Error", "Python executable not found at " & $sPythonPath & ". Please ensure the Demucs virtual environment is correctly set up.")
        Return SetError(1, 0, False)
    EndIf

    ; Validate the Python version
    Local $sPythonCheck = Run('"' & $sPythonPath & '" --version', "", @SW_HIDE, $STDOUT_CHILD + $STDERR_MERGED)
    If $sPythonCheck = 0 Then
        _Log("Failed to run Python version check", True)
        MsgBox($MB_ICONERROR, "Error", "Failed to run Python version check for " & $sPythonPath)
        Return SetError(2, 0, False)
    EndIf
    Local $sOutput = "", $sVersionOutput = ""
    While ProcessExists($sPythonCheck)
        $sOutput = StdoutRead($sPythonCheck)
        If Not @error And $sOutput <> "" Then
            $sVersionOutput &= $sOutput
        EndIf
        $sOutput = StderrRead($sPythonCheck)
        If Not @error And $sOutput <> "" Then
            $sVersionOutput &= $sOutput
        EndIf
        Sleep(10)
    WEnd
    ProcessWaitClose($sPythonCheck)
    _Log("Demucs Python version: " & $sVersionOutput)

    ; Ensure output directory exists
    If Not FileExists($sOutputDir) Then
        DirCreate($sOutputDir)
        If Not FileExists($sOutputDir) Then
            _Log("Failed to create output directory: " & $sOutputDir, True)
            MsgBox($MB_ICONERROR, "Error", "Failed to create output directory: " & $sOutputDir)
            Return SetError(3, 0, False)
        EndIf
    EndIf

    ; Create model-specific subdirectory (e.g., htdemucs, htdemucs_6s)
    Local $sModelSubDir = $sOutputDir & "\" & $sModel
    If Not FileExists($sModelSubDir) Then
        DirCreate($sModelSubDir)
        If Not FileExists($sModelSubDir) Then
            _Log("Failed to create model subdirectory: " & $sModelSubDir, True)
            MsgBox($MB_ICONERROR, "Error", "Failed to create model subdirectory: " & $sModelSubDir)
            Return SetError(4, 0, False)
        EndIf
    EndIf

    ; Construct the command using the full path to python.exe
    Local $sCmd
    If $sModel = "htdemucs_2s" Then
        $sCmd = '"' & $sPythonPath & '" -m demucs --two-stems vocals --device cpu -o "' & $sModelSubDir & '" "' & $sSong & '"'
    ElseIf $sModel = "htdemucs_6s" Then
        $sCmd = '"' & $sPythonPath & '" -m demucs -n htdemucs_6s --device cpu -o "' & $sModelSubDir & '" "' & $sSong & '"'
    Else
        $sCmd = '"' & $sPythonPath & '" -m demucs --device cpu -o "' & $sModelSubDir & '" "' & $sSong & '"'
    EndIf

    Local $sLogFile = @ScriptDir & "\logs\demucs_log.txt"
    Local $hLogFile = FileOpen($sLogFile, 2) ; Overwrite mode
    If $hLogFile = -1 Then
        _Log("Failed to open demucs_log.txt for writing", True)
        MsgBox($MB_ICONERROR, "Error", "Failed to open demucs_log.txt for writing")
        Return SetError(7, 0, False)
    EndIf
    _Log("Opened demucs_log.txt for writing")
    FileWrite($hLogFile, "Command: " & $sCmd & @CRLF)

    Local $iPID = Run($sCmd, "", @SW_HIDE, $STDOUT_CHILD + $STDERR_MERGED)
    If $iPID = 0 Then
        _Log("Failed to start Demucs command: " & $sCmd, True)
        FileWrite($hLogFile, "Error: Failed to start Demucs command: " & $sCmd & @CRLF)
        FileClose($hLogFile)
        MsgBox($MB_ICONERROR, "Error", "Failed to start Demucs command. Check log for details.")
        Return SetError(8, 0, False)
    EndIf
    _Log("Started Demucs process with PID: " & $iPID)

    ; Create a Google Blue brush for the progress bar
    Local $hBrushTeal = _GDIPlus_BrushCreateSolid($GOOGLE_BLUE)

    Local $iProgress = 0
    While ProcessExists($iPID)
        $sOutput = StdoutRead($iPID)
        If Not @error And $sOutput <> "" Then
            _Log("[Demucs STDOUT] " & $sOutput)
            FileWrite($hLogFile, "[STDOUT] " & $sOutput)
            ; Parse for progress percentage (e.g., "45% |")
            Local $aMatch = StringRegExp($sOutput, "(\d+)%\s*\|", 1)
            If Not @error Then
                $iProgress = Number($aMatch[0])
                _Log("Progress updated to: " & $iProgress & "%")
                GUICtrlSetData($hProgressLabel, "Task Progress: " & $iProgress & "%")
                _GDIPlus_GraphicsFillRect($hGraphics, 0, 0, ($iGuiWidth - 20) * $iProgress / 100, 20, $hBrushTeal)
            EndIf
        EndIf
        $sOutput = StderrRead($iPID)
        If Not @error And $sOutput <> "" Then
            _Log("[Demucs STDERR] " & $sOutput)
            FileWrite($hLogFile, "[STDERR] " & $sOutput)
        EndIf
        Sleep(100)
    WEnd

    ; Capture any remaining output
    $sOutput = StdoutRead($iPID)
    If Not @error And $sOutput <> "" Then
        _Log("[Demucs STDOUT] " & $sOutput)
        FileWrite($hLogFile, "[STDOUT] " & $sOutput)
    EndIf
    $sOutput = StderrRead($iPID)
    If Not @error And $sOutput <> "" Then
        _Log("[Demucs STDERR] " & $sOutput)
        FileWrite($hLogFile, "[STDERR] " & $sOutput)
    EndIf

    Local $iExitCode = ProcessWaitClose($iPID)
    If $iExitCode <> 0 Then
        _Log("Demucs process exited with non-zero code: " & $iExitCode & ". Output files were generated successfully, but this may indicate a minor issue.", True)
    Else
        _Log("Demucs process exited with code: " & $iExitCode)
    EndIf
    FileWrite($hLogFile, "Process exited with code: " & $iExitCode & @CRLF)
    FileClose($hLogFile)

    ; Clean up the brush
    _GDIPlus_BrushDispose($hBrushTeal)

    ; Check for expected output files
    Local $sOutputPath = $sModelSubDir & "\" & StringRegExpReplace($sSong, "^.*\\", "")
    $sOutputPath = StringRegExpReplace($sOutputPath, "\.[^.]+$", "")
    Local $aExpectedFiles[4] = ["vocals.wav", "drums.wav", "bass.wav", "other.wav"]
    If $sModel = "htdemucs_2s" Then
        Dim $aExpectedFiles[2] = ["vocals.wav", "other.wav"]
    ElseIf $sModel = "htdemucs_6s" Then
        Dim $aExpectedFiles[6] = ["vocals.wav", "drums.wav", "bass.wav", "guitar.wav", "piano.wav", "other.wav"]
    EndIf
    Local $iFound = 0
    For $i = 0 To UBound($aExpectedFiles) - 1
        If FileExists($sOutputPath & "\" & $aExpectedFiles[$i]) Then $iFound += 1
    Next

    If $iFound = UBound($aExpectedFiles) Then
        _Log("Successfully processed " & $sSong & ": found " & $iFound & " output files")
        For $i = 0 To UBound($aExpectedFiles) - 1
            _GUICtrlListView_AddItem($hOutputListView, $sOutputPath & "\" & $aExpectedFiles[$i])
        Next
        Return True
    Else
        _Log("Failed to process " & $sSong & ": expected " & UBound($aExpectedFiles) & " output files, found " & $iFound, True)
        Local $sLogContent = FileRead($sLogFile)
        If StringLen($sLogContent) > 1000 Then
            $sLogContent = StringLeft($sLogContent, 1000) & "... (see full log at " & $sLogFile & ")"
        EndIf
        MsgBox($MB_ICONERROR, "Demucs Error", "Failed to process " & $sSong & ". Expected " & UBound($aExpectedFiles) & " output files, found " & $iFound & "." & @CRLF & @CRLF & "Log Details:" & @CRLF & $sLogContent)
        Return SetError(9, 0, False)
    EndIf
EndFunc




Func _ProcessSpleeter($sSong, $sModel, $sOutputDir)
    _Log("Entering _ProcessSpleeter: File=" & $sSong & ", Model=" & $sModel)

    ; Define the full path to Spleeter's python.exe
    Local $sPythonPath = @ScriptDir & "\installs\Spleeter\spleeter_env\Scripts\python.exe"
    If Not FileExists($sPythonPath) Then
        _Log("Python executable not found in Spleeter virtual environment: " & $sPythonPath, True)
        MsgBox($MB_ICONERROR, "Error", "Python executable not found at " & $sPythonPath & ". Please ensure the Spleeter virtual environment is correctly set up.")
        Return SetError(1, 0, False)
    EndIf

    ; Validate the Python version
    Local $sPythonCheck = Run('"' & $sPythonPath & '" --version', "", @SW_HIDE, $STDOUT_CHILD + $STDERR_MERGED)
    If $sPythonCheck = 0 Then
        _Log("Failed to run Python version check", True)
        MsgBox($MB_ICONERROR, "Error", "Failed to run Python version check for " & $sPythonPath)
        Return SetError(2, 0, False)
    EndIf
    Local $sOutput
    While ProcessExists($sPythonCheck)
        $sOutput &= StdoutRead($sPythonCheck)
        $sOutput &= StderrRead($sPythonCheck)
        Sleep(10)
    WEnd
    ProcessWaitClose($sPythonCheck)
    _Log("Spleeter Python version: " & $sOutput)

    ; Ensure output directory exists
    If Not FileExists($sOutputDir) Then
        DirCreate($sOutputDir)
        If Not FileExists($sOutputDir) Then
            _Log("Failed to create output directory: " & $sOutputDir, True)
            MsgBox($MB_ICONERROR, "Error", "Failed to create output directory: " & $sOutputDir)
            Return SetError(3, 0, False)
        EndIf
    EndIf

    ; Create model-specific subdirectory (e.g., 2stems, 4stems)
    Local $sModelSubDir = $sOutputDir & "\" & $sModel
    If Not FileExists($sModelSubDir) Then
        DirCreate($sModelSubDir)
        If Not FileExists($sModelSubDir) Then
            _Log("Failed to create model subdirectory: " & $sModelSubDir, True)
            MsgBox($MB_ICONERROR, "Error", "Failed to create model subdirectory: " & $sModelSubDir)
            Return SetError(4, 0, False)
        EndIf
    EndIf

    ; Construct the command using the full path to python.exe
    Local $sStemConfig = "spleeter:" & $sModel
    Local $sCmd = '"' & $sPythonPath & '" -m spleeter separate -p ' & $sStemConfig & ' -o "' & $sModelSubDir & '" "' & $sSong & '"'

    Local $sLogFile = @ScriptDir & "\logs\spleeter_log.txt"
    Local $hLogFile = FileOpen($sLogFile, 2) ; Overwrite mode
    If $hLogFile = -1 Then
        _Log("Failed to open spleeter_log.txt for writing", True)
        MsgBox($MB_ICONERROR, "Error", "Failed to open spleeter_log.txt for writing")
        Return SetError(7, 0, False)
    EndIf
    _Log("Opened spleeter_log.txt for writing")
    FileWrite($hLogFile, "Command: " & $sCmd & @CRLF)

    Local $iPID = Run($sCmd, "", @SW_HIDE, $STDOUT_CHILD + $STDERR_MERGED)
    If $iPID = 0 Then
        _Log("Failed to start Spleeter command: " & $sCmd, True)
        FileWrite($hLogFile, "Error: Failed to start Spleeter command: " & $sCmd & @CRLF)
        FileClose($hLogFile)
        MsgBox($MB_ICONERROR, "Error", "Failed to start Spleeter command. Check log for details.")
        Return SetError(8, 0, False)
    EndIf
    _Log("Started Spleeter process with PID: " & $iPID)

    ; Create a Google Blue brush for the progress bar
    Local $hBrushTeal = _GDIPlus_BrushCreateSolid($GOOGLE_BLUE)

    Local $iProgress = 0
    While ProcessExists($iPID)
        $sOutput = StdoutRead($iPID)
        If Not @error And $sOutput <> "" Then
            _Log("[Spleeter STDOUT] " & $sOutput)
            FileWrite($hLogFile, "[STDOUT] " & $sOutput)
            ; Parse for progress percentage (e.g., "45%")
            Local $aMatch = StringRegExp($sOutput, "(\d+)%", 1)
            If Not @error Then
                $iProgress = Number($aMatch[0])
                _Log("Progress updated to: " & $iProgress & "%")
                GUICtrlSetData($hProgressLabel, "Task Progress: " & $iProgress & "%")
                _GDIPlus_GraphicsFillRect($hGraphics, 0, 0, ($iGuiWidth - 20) * $iProgress / 100, 20, $hBrushTeal)
            EndIf
        EndIf
        $sOutput = StderrRead($iPID)
        If Not @error And $sOutput <> "" Then
            _Log("[Spleeter STDERR] " & $sOutput)
            FileWrite($hLogFile, "[STDERR] " & $sOutput)
        EndIf
        Sleep(100)
    WEnd

    ; Capture any remaining output
    $sOutput = StdoutRead($iPID)
    If $sOutput <> "" Then
        _Log("[Spleeter STDOUT] " & $sOutput)
        FileWrite($hLogFile, "[STDOUT] " & $sOutput)
    EndIf
    $sOutput = StderrRead($iPID)
    If $sOutput <> "" Then
        _Log("[Spleeter STDERR] " & $sOutput)
        FileWrite($hLogFile, "[STDERR] " & $sOutput)
    EndIf

    Local $iExitCode = ProcessWaitClose($iPID)
    _Log("Spleeter process exited with code: " & $iExitCode)
    FileWrite($hLogFile, "Process exited with code: " & $iExitCode & @CRLF)
    FileClose($hLogFile)

    ; Clean up the brush
    _GDIPlus_BrushDispose($hBrushTeal)

    ; Check for expected output files
    Local $sFileName = StringRegExpReplace($sSong, "^.*\\", "")
    $sFileName = StringRegExpReplace($sFileName, "\.[^.]+$", "")
    Local $sOutputPath = $sModelSubDir & "\" & $sFileName
    Local $aExpectedFiles[2] = ["vocals.wav", "accompaniment.wav"]
    If $sModel = "4stems" Then
        Dim $aExpectedFiles[4] = ["vocals.wav", "drums.wav", "bass.wav", "other.wav"]
    ElseIf $sModel = "5stems" Then
        Dim $aExpectedFiles[5] = ["vocals.wav", "drums.wav", "bass.wav", "piano.wav", "other.wav"]
    EndIf
    Local $iFound = 0
    For $i = 0 To UBound($aExpectedFiles) - 1
        If FileExists($sOutputPath & "\" & $aExpectedFiles[$i]) Then $iFound += 1
    Next

    If $iFound = UBound($aExpectedFiles) Then
        _Log("Successfully processed " & $sSong & ": found " & $iFound & " output files")
        For $i = 0 To UBound($aExpectedFiles) - 1
            _GUICtrlListView_AddItem($hOutputListView, $sOutputPath & "\" & $aExpectedFiles[$i])
        Next
        Return True
    Else
        _Log("Failed to process " & $sSong & ": expected " & UBound($aExpectedFiles) & " output files, found " & $iFound, True)
        Local $sLogContent = FileRead($sLogFile)
        If StringLen($sLogContent) > 1000 Then
            $sLogContent = StringLeft($sLogContent, 1000) & "... (see full log at " & $sLogFile & ")"
        EndIf
        MsgBox($MB_ICONERROR, "Spleeter Error", "Failed to process " & $sSong & ". Expected " & UBound($aExpectedFiles) & " output files, found " & $iFound & "." & @CRLF & @CRLF & "Log Details:" & @CRLF & $sLogContent)
        Return SetError(9, 0, False)
    EndIf
EndFunc


Func _ProcessUVR5($sSong, $sModel, $sOutputDir)
    _Log("Entering _ProcessUVR5: File=" & $sSong & ", Model=" & $sModel & ", OutputDir=" & $sOutputDir)

    ; Define paths to UVR5's python.exe and activation script
    Local $sPythonPath = @ScriptDir & "\installs\UVR\uvr_env\Scripts\python.exe"
    Local $sActivate = @ScriptDir & "\installs\UVR\uvr_env\Scripts\activate.bat"
    If Not FileExists($sPythonPath) Then
        _Log("Python executable not found in UVR5 virtual environment: " & $sPythonPath, True)
        MsgBox($MB_ICONERROR, "Error", "Python executable not found at " & $sPythonPath & ". Please ensure the UVR5 virtual environment is correctly set up.")
        Return SetError(1, 0, False)
    EndIf
    If Not FileExists($sActivate) Then
        _Log("UVR5 virtual environment activation script not found: " & $sActivate, True)
        MsgBox($MB_ICONERROR, "Error", "UVR5 virtual environment activation script not found at " & $sActivate)
        Return SetError(2, 0, False)
    EndIf
    _Log("Virtual environment found: " & $sActivate)

    ; Resolve model file path from database
    Local $sQuery = "SELECT Path FROM Models WHERE Name = '" & $sModel & "'"
    Local $aResult, $iRows, $iCols
    Local $iRet = _SQLite_GetTable2d($hDb, $sQuery, $aResult, $iRows, $iCols)
    Local $sModelPath
    If $iRet = $SQLITE_OK And $iRows > 0 Then
        $sModelPath = $aResult[1][0]
        $sModelPath = StringReplace($sModelPath, "@ScriptDir@", @ScriptDir)
        _Log("Resolved model path: " & $sModelPath)
        If Not FileExists($sModelPath) Then
            _Log("Model file not found: " & $sModelPath, True)
            MsgBox($MB_ICONERROR, "Error", "Model file not found: " & $sModelPath)
            Return SetError(3, 0, False)
        EndIf
    Else
        _Log("Failed to resolve model path for " & $sModel & ": " & _SQLite_ErrMsg(), True)
        MsgBox($MB_ICONERROR, "Error", "Model path not found for " & $sModel)
        Return SetError(3, 0, False)
    EndIf

    ; Modify output directory to include \output subdirectory
    Local $sModifiedOutputDir = $sOutputDir & "\output"
    If Not FileExists($sModifiedOutputDir) Then
        DirCreate($sModifiedOutputDir)
        If Not FileExists($sModifiedOutputDir) Then
            _Log("Failed to create output directory: " & $sModifiedOutputDir, True)
            MsgBox($MB_ICONERROR, "Error", "Failed to create output directory: " & $sModifiedOutputDir)
            Return SetError(4, 0, False)
        EndIf
        _Log("Created output directory: " & $sModifiedOutputDir)
    EndIf

    ; Define the full path to separate.py
    Local $sScriptPath = @ScriptDir & "\installs\UVR\uvr-main\separate.py"
    If Not FileExists($sScriptPath) Then
        _Log("UVR5 script not found: " & $sScriptPath, True)
        MsgBox($MB_ICONERROR, "Error", "UVR5 script not found at " & $sScriptPath)
        Return SetError(5, 0, False)
    EndIf

    ; Read MDX-Net parameters from settings.ini
    Local $iSegmentSize = Int(IniRead($sSettingsIni, "MDXNet", "SegmentSize", 256))
    Local $fOverlap = Number(IniRead($sSettingsIni, "MDXNet", "Overlap", 0.25))
    Local $bDenoise = IniRead($sSettingsIni, "MDXNet", "Denoise", "false") = "true" ? "true" : "false"
    Local $iBatchSize = Int(IniRead($sSettingsIni, "MDXNet", "BatchSize", 1))
    Local $iAggressiveness = Int(IniRead($sSettingsIni, "MDXNet", "Aggressiveness", 10))
    Local $bTTA = IniRead($sSettingsIni, "MDXNet", "TTA", "false") = "true" ? "true" : "false"
    Local $sHighEndProcess = IniRead($sSettingsIni, "MDXNet", "HighEndProcess", "mirroring")

    ; Validate parameters
    If $iSegmentSize <= 0 Then
        _Log("Invalid Segment Size: " & $iSegmentSize, True)
        MsgBox($MB_ICONERROR, "Error", "Segment Size must be a positive integer.")
        Return SetError(6, 0, False)
    EndIf
    If $fOverlap < 0 Or $fOverlap > 1 Then
        _Log("Invalid Overlap: " & $fOverlap, True)
        MsgBox($MB_ICONERROR, "Error", "Overlap must be between 0 and 1.")
        Return SetError(6, 0, False)
    EndIf
    If $iBatchSize <= 0 Then
        _Log("Invalid Batch Size: " & $iBatchSize, True)
        MsgBox($MB_ICONERROR, "Error", "Batch Size must be a positive integer.")
        Return SetError(6, 0, False)
    EndIf
    If $iAggressiveness < 0 Or $iAggressiveness > 100 Then
        _Log("Invalid Aggressiveness: " & $iAggressiveness, True)
        MsgBox($MB_ICONERROR, "Error", "Aggressiveness must be between 0 and 100.")
        Return SetError(6, 0, False)
    EndIf
    If Not ($sHighEndProcess = "none" Or $sHighEndProcess = "mirroring" Or $sHighEndProcess = "mirroring2") Then
        _Log("Invalid High End Process: " & $sHighEndProcess, True)
        MsgBox($MB_ICONERROR, "Error", "High End Process must be 'none', 'mirroring', or 'mirroring2'.")
        Return SetError(6, 0, False)
    EndIf

    ; Construct the command with MDX-Net switches
    Local $sCmd = 'cmd /c "' & $sActivate & ' && "' & $sPythonPath & '" "' & $sScriptPath & '" ' & _
                  '--model "' & $sModelPath & '" ' & _
                  '--input_file "' & $sSong & '" ' & _
                  '--output_dir "' & $sModifiedOutputDir & '" ' & _
                  '--segment_size ' & $iSegmentSize & ' ' & _
                  '--overlap ' & $fOverlap & ' ' & _
                  '--denoise ' & $bDenoise & ' ' & _
                  '--batch_size ' & $iBatchSize & ' ' & _
                  '--aggressiveness ' & $iAggressiveness & ' ' & _
                  '--tta ' & $bTTA & ' ' & _
                  '--high_end_process ' & $sHighEndProcess & ' && exit"'
    _Log("UVR5 command: " & $sCmd)

    Local $sLogFile = @ScriptDir & "\logs\uvr5_log.txt"
    Local $hLogFile = FileOpen($sLogFile, 2)
    If $hLogFile = -1 Then
        _Log("Failed to open uvr5_log.txt for writing", True)
        MsgBox($MB_ICONERROR, "Error", "Failed to open uvr5_log.txt for writing")
        Return SetError(7, 0, False)
    EndIf
    _Log("Opened uvr5_log.txt for writing")
    FileWrite($hLogFile, "Command: " & $sCmd & @CRLF)

    Local $sWorkingDir = @ScriptDir & "\installs\UVR\uvr-main"
    Local $iPID = Run($sCmd, $sWorkingDir, @SW_HIDE, $STDOUT_CHILD + $STDERR_MERGED)
    If $iPID = 0 Then
        _Log("Failed to start UVR5 command: " & $sCmd, True)
        FileWrite($hLogFile, "Error: Failed to start UVR5 command: " & $sCmd & @CRLF)
        FileClose($hLogFile)
        MsgBox($MB_ICONERROR, "Error", "Failed to start UVR5 command. Check log for details.")
        Return SetError(8, 0, False)
    EndIf
    _Log("Started UVR5 process with PID: " & $iPID)

    ; Create a Google Blue brush for the progress bar
    Local $hBrushTeal = _GDIPlus_BrushCreateSolid($GOOGLE_BLUE)

    Local $sOutput = "", $iProgress = 0
    While ProcessExists($iPID)
        $sOutput = StdoutRead($iPID)
        If Not @error And $sOutput <> "" Then
            _Log("[UVR5 STDOUT] " & $sOutput)
            FileWrite($hLogFile, "[STDOUT] " & $sOutput)
            Local $aMatch = StringRegExp($sOutput, "(\d+)%", 1)
            If Not @error Then
                $iProgress = Number($aMatch[0])
                _Log("Progress updated to: " & $iProgress & "%")
                GUICtrlSetData($hProgressLabel, "Task Progress: " & $iProgress & "%")
                _GDIPlus_GraphicsFillRect($hGraphics, 0, 0, ($iGuiWidth - 20) * $iProgress / 100, 20, $hBrushTeal)
            EndIf
        EndIf
        $sOutput = StderrRead($iPID)
        If Not @error And $sOutput <> "" Then
            _Log("[UVR5 STDERR] " & $sOutput)
            FileWrite($hLogFile, "[STDERR] " & $sOutput)
        EndIf
        Sleep(100)
    WEnd

    ; Capture any remaining output
    $sOutput = StdoutRead($iPID)
    If Not @error And $sOutput <> "" Then
        _Log("[UVR5 STDOUT] " & $sOutput)
        FileWrite($hLogFile, "[STDOUT] " & $sOutput)
    EndIf
    $sOutput = StderrRead($iPID)
    If Not @error And $sOutput <> "" Then
        _Log("[UVR5 STDERR] " & $sOutput)
        FileWrite($hLogFile, "[STDERR] " & $sOutput)
    EndIf

    FileClose($hLogFile)
    Local $iExitCode = ProcessWaitClose($iPID)
    _Log("UVR5 process exited with code: " & $iExitCode)
    FileWrite($hLogFile, "Process exited with code: " & $iExitCode & @CRLF)

    ; Clean up the brush
    _GDIPlus_BrushDispose($hBrushTeal)

    ; Check for expected output files
    Local $sFileName = StringRegExpReplace($sSong, "^.*\\", "")
    $sFileName = StringRegExpReplace($sFileName, "\.[^.]+$", "")
    Local $sOutputPath = $sModifiedOutputDir
    Local $aExpectedFiles[2] = [$sFileName & "_vocals.wav", $sFileName & "_instrumental.wav"]
    Local $iFound = 0
    For $i = 0 To UBound($aExpectedFiles) - 1
        If FileExists($sOutputPath & "\" & $aExpectedFiles[$i]) Then
            $iFound += 1
            _GUICtrlListView_AddItem($hOutputListView, $sOutputPath & "\" & $aExpectedFiles[$i])
        EndIf
    Next

    If $iFound = UBound($aExpectedFiles) Then
        _Log("Successfully processed " & $sSong & ": found " & $iFound & " output files in " & $sOutputPath)
        Return True
    Else
        _Log("Failed to process " & $sSong & ": expected " & UBound($aExpectedFiles) & " output files, found " & $iFound, True)
        Local $sLogContent = FileRead($sLogFile)
        If StringLen($sLogContent) > 1000 Then
            $sLogContent = StringLeft($sLogContent, 1000) & "... (see full log at " & $sLogFile & ")"
        EndIf
        MsgBox($MB_ICONERROR, "UVR5 Error", "Failed to process " & $sSong & ". Expected " & UBound($aExpectedFiles) & " output files, found " & $iFound & "." & @CRLF & @CRLF & "Log Details:" & @CRLF & $sLogContent)
        Return SetError(9, 0, False)
    EndIf
EndFunc



Func _ProcessFile($sSong, $sModel, $sOutputDir)
    _Log("Entering _ProcessFile: File=" & $sSong & ", Model=" & $sModel & ", OutputDir=" & $sOutputDir)

    ; Get model details to determine the application
    Local $aDetails = _GetModelDetails($sModel)
    If @error Then
        _Log("Failed to get model details for " & $sModel, True)
        MsgBox($MB_ICONERROR, "Error", "Failed to retrieve model details for " & $sModel)
        Return False
    EndIf
    Local $sApp = $aDetails[0] ; Application (Demucs, Spleeter, or UVR5)

    ; Call the appropriate processing function based on the application
    Local $bSuccess = False
    Switch $sApp
        Case "Demucs"
            _Log("Processing with Demucs model: " & $sModel)
            $bSuccess = _ProcessDemucs($sSong, $sModel, $sOutputDir)
        Case "Spleeter"
            _Log("Processing with Spleeter model: " & $sModel)
            $bSuccess = _ProcessSpleeter($sSong, $sModel, $sOutputDir)
        Case "UVR5"
            _Log("Processing with UVR5 model: " & $sModel)
            $bSuccess = _ProcessUVR5($sSong, $sModel, $sOutputDir)
        Case Else
            _Log("Unsupported application for model " & $sModel & ": " & $sApp, True)
            MsgBox($MB_ICONERROR, "Error", "Unsupported application: " & $sApp)
            Return False
    EndSwitch

    ; Check if processing was successful
    If Not $bSuccess Then
        _Log("Processing failed for " & $sSong & " with model " & $sModel, True)
        Return False
    EndIf

    ; Verify output files (optional, since model-specific functions already check)
    Local $sDrive, $sDir, $sFileName, $sExtension
    _PathSplit($sSong, $sDrive, $sDir, $sFileName, $sExtension)
    Local $sBaseName = $sFileName
    Local $sOutputVocals = $sOutputDir & "\" & $sBaseName & "_vocals.wav"
    Local $sOutputInstrumental = $sOutputDir & "\" & $sBaseName & "_instrumental.wav"

    If FileExists($sOutputVocals) Then
        _Log("Vocals file created: " & $sOutputVocals)
    Else
        _Log("Vocals file not found: " & $sOutputVocals, True)
    EndIf

    If FileExists($sOutputInstrumental) Then
        _Log("Instrumental file created: " & $sOutputInstrumental)
    Else
        _Log("Instrumental file not found: " & $sOutputInstrumental, True)
    EndIf

    ; Return True only if expected files exist (adjust based on model requirements)
    If FileExists($sOutputVocals) And FileExists($sOutputInstrumental) Then
        Return True
    Else
        _Log("Processing incomplete: Not all expected output files were created", True)
        Return False
    EndIf
EndFunc



#EndRegion ;**** Separation Functions ****
#EndRegion Part3





;**************************************************
;********************Part 4************************
;**************************************************
#Region Part4
#Region ;**** Event Handlers ****
Func _InputButtonHandler()
    _Log("Entering _InputButtonHandler")
    Local $sNewDir = FileSelectFolder("Select Input Directory", "", 7, $sInputPath)
    If @error Then
        _Log("No input directory selected")
        Return
    EndIf
    $sInputPath = $sNewDir
    _Log("Selected input directory: " & $sInputPath)
    IniWrite($sSettingsIni, "Paths", "InputDir", $sInputPath)
    _GUICtrlListView_DeleteAllItems($hInputListView)
    Local $aInputFiles = _FileListToArrayRec($sInputPath, "*.wav;*.mp3;*.flac", $FLTAR_FILES, $FLTAR_RECUR, $FLTAR_NOSORT, $FLTAR_FULLPATH)
    If Not @error Then
        _Log("Found " & $aInputFiles[0] & " audio files in " & $sInputPath)
        For $i = 1 To $aInputFiles[0]
            _GUICtrlListView_AddItem($hInputListView, $aInputFiles[$i])
        Next
    Else
        _Log("No audio files found in " & $sInputPath)
    EndIf
    _Log("Exiting _InputButtonHandler")
EndFunc

Func _OutputButtonHandler()
    _Log("Entering _OutputButtonHandler")
    Local $sNewDir = FileSelectFolder("Select Output Directory", "", 7, $sOutputPath)
    If @error Then
        _Log("No output directory selected")
        Return
    EndIf
    $sOutputPath = $sNewDir
    _Log("Selected output directory: " & $sOutputPath)
    IniWrite($sSettingsIni, "Paths", "OutputDir", $sOutputPath)
    _GUICtrlListView_DeleteAllItems($hOutputListView)
    Local $aOutputFiles = _FileListToArrayRec($sOutputPath, "*.wav;*.mp3;*.flac", $FLTAR_FILES, $FLTAR_RECUR, $FLTAR_NOSORT, $FLTAR_FULLPATH)
    If Not @error Then
        _Log("Found " & $aOutputFiles[0] & " audio files in " & $sOutputPath)
        For $i = 1 To $aOutputFiles[0]
            _GUICtrlListView_AddItem($hOutputListView, $aOutputFiles[$i])
        Next
    Else
        _Log("No audio files found in " & $sOutputPath)
    EndIf
    _Log("Exiting _OutputButtonHandler")
EndFunc

Func _AddButtonHandler()
    _Log("Entering _AddButtonHandler")
    Local $iSelected = _GUICtrlListView_GetSelectedIndices($hInputListView, True)
    If $iSelected[0] = 0 Then
        _Log("No items selected in Input ListView")
        Return
    EndIf
    For $i = 1 To $iSelected[0]
        Local $sFile = _GUICtrlListView_GetItemText($hInputListView, $iSelected[$i])
        _Log("Adding file to Process Queue: " & $sFile)
        Local $iIndex = _GUICtrlListView_AddItem($hBatchList, $sFile)
        _GUICtrlListView_SetItemChecked($hBatchList, $iIndex, True)
    Next
    _Log("Exiting _AddButtonHandler")
EndFunc

Func _ClearButtonHandler()
    _Log("Entering _ClearButtonHandler")
    _GUICtrlListView_DeleteAllItems($hBatchList)
    _Log("Cleared Process Queue")
    _Log("Exiting _ClearButtonHandler")
EndFunc

Func _DeleteButtonHandler()
    _Log("Entering _DeleteButtonHandler")
    Local $iSelected = _GUICtrlListView_GetSelectedIndices($hBatchList, True)
    If $iSelected[0] = 0 Then
        _Log("No items selected in Process Queue")
        Return
    EndIf
    For $i = $iSelected[0] To 1 Step -1
        _Log("Deleting item from Process Queue: " & _GUICtrlListView_GetItemText($hBatchList, $iSelected[$i]))
        _GUICtrlListView_DeleteItem($hBatchList, $iSelected[$i])
    Next
    _Log("Exiting _DeleteButtonHandler")
EndFunc

Func _SeparateButtonHandler()
    _Log("Entering _SeparateButtonHandler")
    Local $iItemCount = _GUICtrlListView_GetItemCount($hBatchList)
    If $iItemCount = 0 Then
        _Log("Process Queue is empty")
        MsgBox($MB_ICONWARNING, "Warning", "Process Queue is empty.")
        Return
    EndIf

    Local $iCheckedCount = 0
    For $i = 0 To $iItemCount - 1
        If _GUICtrlListView_GetItemChecked($hBatchList, $i) Then $iCheckedCount += 1
    Next
    If $iCheckedCount = 0 Then
        _Log("No items checked in Process Queue")
        MsgBox($MB_ICONWARNING, "Warning", "No items are checked for processing.")
        Return
    EndIf

    Local $sModel = GUICtrlRead($hModelCombo)
    If $sModel = "" Or $sModel = "No models available" Then
        _Log("No model selected for processing", True)
        MsgBox($MB_ICONERROR, "Error", "Please select a valid model.")
        Return
    EndIf

    Local $iProcessed = 0
    GUICtrlSetData($hCountLabel, "Tasks Completed: 0/" & $iCheckedCount)
    For $i = 0 To $iItemCount - 1
        If Not _GUICtrlListView_GetItemChecked($hBatchList, $i) Then ContinueLoop
        Local $sSong = _GUICtrlListView_GetItemText($hBatchList, $i)
        _Log("Processing song: " & $sSong)
        GUICtrlSetData($hProgressLabel, "Task Progress: 0%")
        _GDIPlus_GraphicsFillRect($hGraphics, 0, 0, $iGuiWidth - 20, 20, $hBrushGray)
        Local $bSuccess = _ProcessFile($sSong, $sModel, $sOutputPath)
        If $bSuccess Then
            $iProcessed += 1
            GUICtrlSetData($hProgressLabel, "Task Progress: 100%")
            _GDIPlus_GraphicsFillRect($hGraphics, 0, 0, $iGuiWidth - 20, 20, $hBrushGreen)
            GUICtrlSetData($hCountLabel, "Tasks Completed: " & $iProcessed & "/" & $iCheckedCount)
        Else
            GUICtrlSetData($hProgressLabel, "Task Progress: Failed")
            _GDIPlus_GraphicsFillRect($hGraphics, 0, 0, $iGuiWidth - 20, 20, $hBrushYellow)
        EndIf
    Next
    _Log("Processing complete: " & $iProcessed & "/" & $iCheckedCount & " tasks successful")
    MsgBox($MB_ICONINFORMATION, "Complete", "Processing complete: " & $iProcessed & "/" & $iCheckedCount & " tasks successful.")
    _Log("Exiting _SeparateButtonHandler")
EndFunc

Func _SaveSettingsButtonHandler()
    _Log("Entering _SaveSettingsButtonHandler")
    Local $sModel = GUICtrlRead($hModelCombo)
    If $sModel = "" Or $sModel = "No models available" Then
        _Log("No model selected to save settings", True)
        MsgBox($MB_ICONWARNING, "Warning", "No model selected to save settings.")
        Return
    EndIf
    Local $sDescription = GUICtrlRead($hDescEdit)
    Local $sComments = GUICtrlRead($hCommentsEdit)
    If _SaveModelDetails($sModel, $sDescription, $sComments) Then
        MsgBox($MB_ICONINFORMATION, "Success", "Settings saved for model: " & $sModel)
    Else
        MsgBox($MB_ICONERROR, "Error", "Failed to save settings for model: " & $sModel)
    EndIf
    IniWrite($sSettingsIni, "GUI", "LastModel", $sModel)
    Local $iItemCount = _GUICtrlListView_GetItemCount($hBatchList)
    If $iItemCount > 0 Then
        Local $sLastSong = _GUICtrlListView_GetItemText($hBatchList, 0)
        IniWrite($sSettingsIni, "GUI", "LastSong", $sLastSong)
    EndIf
    _Log("Exiting _SaveSettingsButtonHandler")
EndFunc

Func _ModelComboHandler()
    _Log("Entering _ModelComboHandler")
    Local $sModel = GUICtrlRead($hModelCombo)
    If $sModel = "" Or $sModel = "No models available" Then
        _Log("Invalid model selected in combo box", True)
        _UpdateModelDetails("")
        Return
    EndIf
    _Log("Model selected: " & $sModel)
    _UpdateModelDetails($sModel)
    _Log("Exiting _ModelComboHandler")
EndFunc

Func _TabHandler()
    _Log("Entering _TabHandler")
    Local $iTabIndex = _GUICtrlTab_GetCurSel($hTab)
    _Log("Tab switched to index: " & $iTabIndex)

    ; Delete existing controls to avoid overlap
    If $hModelCombo <> 0 Then
        GUICtrlDelete($hModelNameLabel)
        GUICtrlDelete($hModelCombo)
        GUICtrlDelete($hStemsLabel)
        GUICtrlDelete($hStemsDisplay)
        GUICtrlDelete($hFocusLabel)
        GUICtrlDelete($hFocusDisplay)
        GUICtrlDelete($hDescLabel)
        GUICtrlDelete($hDescEdit)
        GUICtrlDelete($hCommentsLabel)
        GUICtrlDelete($hCommentsEdit)

	If IsDeclared("hSegmentSizeLabel") And $hSegmentSizeLabel <> 0 Then GUICtrlDelete($hSegmentSizeLabel)
	If IsDeclared("hSegmentSizeInput") And $hSegmentSizeInput <> 0 Then GUICtrlDelete($hSegmentSizeInput)
	If IsDeclared("hOverlapLabel") And $hOverlapLabel <> 0 Then GUICtrlDelete($hOverlapLabel)
	If IsDeclared("hOverlapInput") And $hOverlapInput <> 0 Then GUICtrlDelete($hOverlapInput)
	If IsDeclared("hDenoiseCheckbox") And $hDenoiseCheckbox <> 0 Then GUICtrlDelete($hDenoiseCheckbox)
	If IsDeclared("hBatchSizeLabel") And $hBatchSizeLabel <> 0 Then GUICtrlDelete($hBatchSizeLabel)
	If IsDeclared("hBatchSizeInput") And $hBatchSizeInput <> 0 Then GUICtrlDelete($hBatchSizeInput)

#CS 		GUICtrlDelete($hSegmentSizeLabel)
;         GUICtrlDelete($hSegmentSizeInput)
;         GUICtrlDelete($hOverlapLabel)
;         GUICtrlDelete($hOverlapInput)
;         GUICtrlDelete($hDenoiseCheckbox)
;         GUICtrlDelete($hBatchSizeLabel)
;         GUICtrlDelete($hBatchSizeInput)
 #CE
        GUICtrlDelete($hAggressivenessLabel)
        GUICtrlDelete($hAggressivenessInput)
        GUICtrlDelete($hTTACheckbox)
        GUICtrlDelete($hHighEndProcessLabel)
        GUICtrlDelete($hHighEndProcessCombo)
    EndIf

    ; Recreate controls based on the selected tab
    Local $iRightQuadX = ($iGuiWidth - 30) / 2 + 20
    Local $iTopQuadY = 35
    Local $iTabTopY = $iTopQuadY + 30
    Local $iQuadWidth = ($iGuiWidth - 30) / 2
    Local $iDetailsX = $iRightQuadX + 5
    Local $iDetailsY = $iTabTopY + 30
    Local $iDetailsWidth = $iQuadWidth - 10
    Local $iLabelHeight = 20
    Local $iLabelSpacing = 25

    $hModelNameLabel = GUICtrlCreateLabel("Model Name:", $iDetailsX, $iTabTopY, 70, 20)
    $hModelCombo = GUICtrlCreateCombo("", $iDetailsX + 80, $iTabTopY, 150, 25, BitOR($CBS_DROPDOWN, $CBS_AUTOHSCROLL, $WS_VSCROLL))
    $hStemsLabel = GUICtrlCreateLabel("Stems:", $iDetailsX + 235, $iTabTopY, 40, 20)
    $hStemsDisplay = GUICtrlCreateLabel("", $iDetailsX + 275, $iTabTopY, 30, 20)
    $hFocusLabel = GUICtrlCreateLabel("Focus:", $iDetailsX, $iDetailsY, 80, $iLabelHeight)
    $hFocusDisplay = GUICtrlCreateLabel("", $iDetailsX + 80, $iDetailsY, $iDetailsWidth - 80, $iLabelHeight)
    $hDescLabel = GUICtrlCreateLabel("Description:", $iDetailsX, $iDetailsY + $iLabelSpacing, 80, $iLabelHeight)
    $hDescEdit = GUICtrlCreateEdit("", $iDetailsX, $iDetailsY + $iLabelSpacing + 20, $iDetailsWidth, 80, BitOR($ES_AUTOVSCROLL, $ES_WANTRETURN, $WS_VSCROLL))
    $hCommentsLabel = GUICtrlCreateLabel("Comments:", $iDetailsX, $iDetailsY + $iLabelSpacing * 2 + 80, 80, $iLabelHeight)
    $hCommentsEdit = GUICtrlCreateEdit("", $iDetailsX, $iDetailsY + $iLabelSpacing * 2 + 100, $iDetailsWidth, 80, BitOR($ES_AUTOVSCROLL, $ES_WANTRETURN, $WS_VSCROLL))

    ; Add MDX-Net parameter controls for UVR5 tab
    If $iTabIndex = 2 Then
        $hSegmentSizeLabel = GUICtrlCreateLabel("Segment Size:", $iDetailsX, $iDetailsY + $iLabelSpacing * 3 + 180, 80, $iLabelHeight)
        $hSegmentSizeInput = GUICtrlCreateInput(IniRead($sSettingsIni, "MDXNet", "SegmentSize", "256"), $iDetailsX + 80, $iDetailsY + $iLabelSpacing * 3 + 180, 60, $iLabelHeight)
        $hOverlapLabel = GUICtrlCreateLabel("Overlap:", $iDetailsX, $iDetailsY + $iLabelSpacing * 3 + 205, 80, $iLabelHeight)
        $hOverlapInput = GUICtrlCreateInput(IniRead($sSettingsIni, "MDXNet", "Overlap", "0.25"), $iDetailsX + 80, $iDetailsY + $iLabelSpacing * 3 + 205, 60, $iLabelHeight)
        $hDenoiseCheckbox = GUICtrlCreateCheckbox("Denoise", $iDetailsX, $iDetailsY + $iLabelSpacing * 3 + 230, 80, $iLabelHeight)
        If IniRead($sSettingsIni, "MDXNet", "Denoise", "false") = "true" Then GUICtrlSetState($hDenoiseCheckbox, $GUI_CHECKED)
        $hBatchSizeLabel = GUICtrlCreateLabel("Batch Size:", $iDetailsX, $iDetailsY + $iLabelSpacing * 3 + 255, 80, $iLabelHeight)
        $hBatchSizeInput = GUICtrlCreateInput(IniRead($sSettingsIni, "MDXNet", "BatchSize", "1"), $iDetailsX + 80, $iDetailsY + $iLabelSpacing * 3 + 255, 60, $iLabelHeight)
        $hAggressivenessLabel = GUICtrlCreateLabel("Aggressiveness:", $iDetailsX, $iDetailsY + $iLabelSpacing * 3 + 280, 80, $iLabelHeight)
        $hAggressivenessInput = GUICtrlCreateInput(IniRead($sSettingsIni, "MDXNet", "Aggressiveness", "10"), $iDetailsX + 80, $iDetailsY + $iLabelSpacing * 3 + 280, 60, $iLabelHeight)
        $hTTACheckbox = GUICtrlCreateCheckbox("TTA", $iDetailsX, $iDetailsY + $iLabelSpacing * 3 + 305, 80, $iLabelHeight)
        If IniRead($sSettingsIni, "MDXNet", "TTA", "false") = "true" Then GUICtrlSetState($hTTACheckbox, $GUI_CHECKED)
        $hHighEndProcessLabel = GUICtrlCreateLabel("High End Process:", $iDetailsX, $iDetailsY + $iLabelSpacing * 3 + 330, 80, $iLabelHeight)
        $hHighEndProcessCombo = GUICtrlCreateCombo("", $iDetailsX + 80, $iDetailsY + $iLabelSpacing * 3 + 330, 100, $iLabelHeight, BitOR($CBS_DROPDOWNLIST, $CBS_AUTOHSCROLL))
        GUICtrlSetData($hHighEndProcessCombo, "none|mirroring|mirroring2", IniRead($sSettingsIni, "MDXNet", "HighEndProcess", "mirroring"))
    EndIf

    ; Set event handlers for the new controls
    GUICtrlSetOnEvent($hModelCombo, "_ModelComboHandler")
    GUICtrlSetOnEvent($hDescEdit, "_DescEditHandler")
    GUICtrlSetOnEvent($hCommentsEdit, "_CommentsEditHandler")
    If $iTabIndex = 2 Then
        GUICtrlSetOnEvent($hSegmentSizeInput, "_MDXSettingsHandler")
        GUICtrlSetOnEvent($hOverlapInput, "_MDXSettingsHandler")
        GUICtrlSetOnEvent($hDenoiseCheckbox, "_MDXSettingsHandler")
        GUICtrlSetOnEvent($hBatchSizeInput, "_MDXSettingsHandler")
        GUICtrlSetOnEvent($hAggressivenessInput, "_MDXSettingsHandler")
        GUICtrlSetOnEvent($hTTACheckbox, "_MDXSettingsHandler")
        GUICtrlSetOnEvent($hHighEndProcessCombo, "_MDXSettingsHandler")
    EndIf

    ; Populate the combo box
    _UpdateModelDroplist()

    ; Set the default model for the current tab
    Local $sDefaultModel
    Switch $iTabIndex
        Case 0
            $sDefaultModel = "htdemucs"
        Case 1
            $sDefaultModel = "2stems"
        Case 2
            $sDefaultModel = "UVR-MDX-NET-Inst_Main"
    EndSwitch

    If $sDefaultModel <> "" Then
        If _IsModelCompatibleWithTab($sDefaultModel, $iTabIndex) Then
            _Log("Setting default model for tab " & $iTabIndex & ": " & $sDefaultModel)
            GUICtrlSetData($hModelCombo, $sDefaultModel)
            Local $sSelectedModel = GUICtrlRead($hModelCombo)
            If $sSelectedModel = $sDefaultModel Then
                _Log("Default model " & $sDefaultModel & " set successfully")
                _UpdateModelDetails($sDefaultModel)
            Else
                _Log("Failed to set default model " & $sDefaultModel & ", current selection: " & $sSelectedModel, True)
                _UpdateModelDetails("")
            EndIf
        Else
            _Log("Default model " & $sDefaultModel & " not found or not compatible with tab " & $iTabIndex & ", selecting first available", True)
            Local $sFirstModel = StringSplit(GUICtrlRead($hModelCombo), "|")[2]
            If $sFirstModel <> "" And $sFirstModel <> "No models available" Then
                _Log("Falling back to first available model: " & $sFirstModel)
                GUICtrlSetData($hModelCombo, $sFirstModel)
                Local $sSelectedModel = GUICtrlRead($hModelCombo)
                If $sSelectedModel = $sFirstModel Then
                    _UpdateModelDetails($sFirstModel)
                Else
                    _Log("Failed to set first available model " & $sFirstModel & ", current selection: " & $sSelectedModel, True)
                    _UpdateModelDetails("")
                EndIf
            Else
                _Log("No models available for tab " & $iTabIndex, True)
                _UpdateModelDetails("")
            EndIf
        EndIf
    Else
        _Log("No default model defined for tab " & $iTabIndex, True)
        _UpdateModelDetails("")
    EndIf

    _Log("Exiting _TabHandler")
EndFunc
Func _MDXSettingsHandler()
    _Log("Entering _MDXSettingsHandler")
    Local $sSegmentSize = GUICtrlRead($hSegmentSizeInput)
    Local $sOverlap = GUICtrlRead($hOverlapInput)
    Local $bDenoise = GUICtrlRead($hDenoiseCheckbox) = $GUI_CHECKED ? "true" : "false"
    Local $sBatchSize = GUICtrlRead($hBatchSizeInput)
    Local $sAggressiveness = GUICtrlRead($hAggressivenessInput)
    Local $bTTA = GUICtrlRead($hTTACheckbox) = $GUI_CHECKED ? "true" : "false"
    Local $sHighEndProcess = GUICtrlRead($hHighEndProcessCombo)

    ; Validate inputs
    If Not StringIsInt($sSegmentSize) Or $sSegmentSize <= 0 Then
        _Log("Invalid Segment Size: " & $sSegmentSize, True)
        MsgBox($MB_ICONWARNING, "Warning", "Segment Size must be a positive integer.")
        Return
    EndIf
    If Not StringIsFloat($sOverlap) And Not StringIsInt($sOverlap) Or $sOverlap < 0 Or $sOverlap > 1 Then
        _Log("Invalid Overlap: " & $sOverlap, True)
        MsgBox($MB_ICONWARNING, "Warning", "Overlap must be a number between 0 and 1.")
        Return
    EndIf
    If Not StringIsInt($sBatchSize) Or $sBatchSize <= 0 Then
        _Log("Invalid Batch Size: " & $sBatchSize, True)
        MsgBox($MB_ICONWARNING, "Warning", "Batch Size must be a positive integer.")
        Return
    EndIf
    If Not StringIsInt($sAggressiveness) Or $sAggressiveness < 0 Or $sAggressiveness > 100 Then
        _Log("Invalid Aggressiveness: " & $sAggressiveness, True)
        MsgBox($MB_ICONWARNING, "Warning", "Aggressiveness must be between 0 and 100.")
        Return
    EndIf
    If Not ($sHighEndProcess = "none" Or $sHighEndProcess = "mirroring" Or $sHighEndProcess = "mirroring2") Then
        _Log("Invalid High End Process: " & $sHighEndProcess, True)
        MsgBox($MB_ICONWARNING, "Warning", "High End Process must be 'none', 'mirroring', or 'mirroring2'.")
        Return
    EndIf

    ; Save to INI file
    IniWrite($sSettingsIni, "MDXNet", "SegmentSize", $sSegmentSize)
    IniWrite($sSettingsIni, "MDXNet", "Overlap", $sOverlap)
    IniWrite($sSettingsIni, "MDXNet", "Denoise", $bDenoise)
    IniWrite($sSettingsIni, "MDXNet", "BatchSize", $sBatchSize)
    IniWrite($sSettingsIni, "MDXNet", "Aggressiveness", $sAggressiveness)
    IniWrite($sSettingsIni, "MDXNet", "TTA", $bTTA)
    IniWrite($sSettingsIni, "MDXNet", "HighEndProcess", $sHighEndProcess)
    _Log("Saved MDX-Net settings: SegmentSize=" & $sSegmentSize & ", Overlap=" & $sOverlap & ", Denoise=" & $bDenoise & ", BatchSize=" & $sBatchSize & ", Aggressiveness=" & $sAggressiveness & ", TTA=" & $bTTA & ", HighEndProcess=" & $sHighEndProcess)
    _Log("Exiting _MDXSettingsHandler")
EndFunc
Func _DescEditHandler()
    _Log("Entering _DescEditHandler")
    ; Placeholder for description edit handling if needed
    _Log("Exiting _DescEditHandler")
EndFunc

Func _CommentsEditHandler()
    _Log("Entering _CommentsEditHandler")
    ; Placeholder for comments edit handling if needed
    _Log("Exiting _CommentsEditHandler")
EndFunc

Func _Exit()
    _Log("Entering _Exit")
    _GDIPlus_BrushDispose($hBrushGray)
    _GDIPlus_BrushDispose($hBrushGreen)
    _GDIPlus_BrushDispose($hBrushYellow)
    _GDIPlus_PenDispose($hPen)
    _GDIPlus_GraphicsDispose($hGraphics)
    _WinAPI_ReleaseDC($hGraphicGUI, $hDC)
    _GDIPlus_Shutdown()
    _SQLite_Close($hDb)
    _SQLite_Shutdown()
    _Log("Exiting application")
    Exit
EndFunc
#EndRegion ;**** Event Handlers ****
#EndRegion Part4


## Recommendations
- Next Steps in a New Thread
In our next session, we can:
Add automatic model parameter detection to separate.py (e.g., infer num_stems from the model).

Convert .pth or .ckpt models to ONNX for broader compatibility.

Integrate 4-stem models like kuielab_a_vocals.onnx into models.ini.

I’m excited to continue this journey in a fresh thread—great work today!  Let me know when you’re ready to start anew.

## Notes
- Au3Check results: [Output from Au3Check, if applicable]
- Runtime observations: [Observations from running the script]
- Git commands executed: [List Git commands run during the session]
- Script updates: [Details of any changes made to the script]
- Any issues encountered: [Problems or errors faced]

## Future Recommendations
- [List tasks or improvements for future sessions]

## Session Completed
- Date: YYYY-MM-DD
- Time: [e.g., 15:30 UTC]